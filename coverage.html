
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>api: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">polen/delivery/controller/api/app_handling_cost_controller.go (0.0%)</option>
				
				<option value="file1">polen/delivery/controller/api/auth_controller.go (55.6%)</option>
				
				<option value="file2">polen/delivery/controller/api/biodata_user_controller.go (0.0%)</option>
				
				<option value="file3">polen/delivery/controller/api/deposite_controller.go (0.0%)</option>
				
				<option value="file4">polen/delivery/controller/api/deposite_interest_controller.go (0.0%)</option>
				
				<option value="file5">polen/delivery/controller/api/late_payment_fee_controller.go (0.0%)</option>
				
				<option value="file6">polen/delivery/controller/api/loan_controller.go (0.0%)</option>
				
				<option value="file7">polen/delivery/controller/api/loan_interest_controller.go (0.0%)</option>
				
				<option value="file8">polen/delivery/controller/api/saldo_controller.go (0.0%)</option>
				
				<option value="file9">polen/delivery/controller/api/topup_controller.go (0.0%)</option>
				
				<option value="file10">polen/repository/application_handling_cost_repository.go (91.9%)</option>
				
				<option value="file11">polen/repository/biodata_user_repository.go (95.5%)</option>
				
				<option value="file12">polen/repository/deposite_interest_repository.go (97.0%)</option>
				
				<option value="file13">polen/repository/deposite_repository.go (62.6%)</option>
				
				<option value="file14">polen/repository/late_payment_repository.go (91.9%)</option>
				
				<option value="file15">polen/repository/loan_interest_repository.go (91.9%)</option>
				
				<option value="file16">polen/repository/loan_repository.go (65.3%)</option>
				
				<option value="file17">polen/repository/saldo_repository.go (89.3%)</option>
				
				<option value="file18">polen/repository/topup_repository.go (94.8%)</option>
				
				<option value="file19">polen/repository/user_repository.go (98.3%)</option>
				
				<option value="file20">polen/usecase/application_handling_cost_usecase.go (92.5%)</option>
				
				<option value="file21">polen/usecase/auth_usecase.go (0.0%)</option>
				
				<option value="file22">polen/usecase/biodata_user_usecase.go (21.4%)</option>
				
				<option value="file23">polen/usecase/deposite_interest_usecase.go (89.7%)</option>
				
				<option value="file24">polen/usecase/deposite_usecase.go (51.2%)</option>
				
				<option value="file25">polen/usecase/late_payment_fee.go (92.5%)</option>
				
				<option value="file26">polen/usecase/loan_interest_usecase.go (93.8%)</option>
				
				<option value="file27">polen/usecase/loan_usecase.go (8.0%)</option>
				
				<option value="file28">polen/usecase/saldo_usecase.go (100.0%)</option>
				
				<option value="file29">polen/usecase/topup_usecase.go (11.5%)</option>
				
				<option value="file30">polen/usecase/user_usecase.go (37.5%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package api

import (
        "net/http"
        "polen/delivery/middleware"
        "polen/model"
        "polen/model/dto"
        "polen/usecase"
        "polen/utils/common"
        "strconv"

        "github.com/gin-gonic/gin"
        "github.com/google/uuid"
)

type AppHandlingCostController struct {
        appHandlingCostUC usecase.AppHandlingCostUsecase
        rg                *gin.RouterGroup
}

// @Summary New Handling Cost
// @Description Create New Apps Handling Cost Data
// @Tags Handling Cost
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body dto.AppHandlingCostReq true "Data application handling cost"
// @Success 200 {object} dto.ResponseData
// @Router /apphandlingcost [POST]
func (p *AppHandlingCostController) createHandler(c *gin.Context) <span class="cov0" title="0">{
        var app dto.AppHandlingCostReq
        if err := c.ShouldBindJSON(&amp;app); err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">var apps model.AppHandlingCost
        apps.Name = app.Name
        apps.Nominal = app.Nominal
        apps.Unit = app.Unit

        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        <span class="cov0" title="0">apps.Id = uuid.NewString()
        code, err := p.appHandlingCostUC.CreateNew(apps)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(code, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponseData{
                Message: "successfully update verification user",
                Data:    apps,
        }

        c.JSON(http.StatusCreated, response)</span>
}

// @Summary Get all Handling Cost
// @Description get all Apps Handling Cost Data
// @Tags Handling Cost
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param page path int true "page of pagination"
// @Param size path int true "size of pagination"
// @Success 200 {object} dto.ResponsePaging
// @Router /apphandlingcost/list/{page}/{size} [GET]
func (p *AppHandlingCostController) paggingHandler(c *gin.Context) <span class="cov0" title="0">{
        // Mengambil parameter dari URL
        page, _ := strconv.Atoi(c.Param("page"))
        size, _ := strconv.Atoi(c.Param("size"))

        // Memberikan nilai default jika parameter kosong
        if page == 0 </span><span class="cov0" title="0">{
                page = 1 // Nilai default untuk page
        }</span>

        <span class="cov0" title="0">if size == 0 </span><span class="cov0" title="0">{
                size = 10 // Nilai default untuk size
        }</span>
        <span class="cov0" title="0">payload := dto.PageRequest{
                Page: page,
                Size: size,
        }

        model, pagereturn, err := p.appHandlingCostUC.Pagging(payload)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponsePaging{
                Message: "Success getting data",
                Data:    model,
                Paging:  pagereturn,
        }

        c.JSON(200, response)</span>
}

func (p *AppHandlingCostController) Route() <span class="cov0" title="0">{
        p.rg.POST("/apphandlingcost", middleware.AuthMiddleware(), p.createHandler)
        p.rg.GET("/apphandlingcost/list/:page/:size", middleware.AuthMiddleware(), p.paggingHandler)
        p.rg.PUT("/apphandlingcost/", middleware.AuthMiddleware(), p.updateHandler)
        p.rg.DELETE("/apphandlingcost/:id", middleware.AuthMiddleware(), p.deleteHandler)

}</span>

// @Summary delete data Handling Cost
// @Description Create New Apps Handling Cost Data
// @Tags Handling Cost
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param id path string true "id data"
// @Success 200 {object} dto.ResponsePaging
// @Router /apphandlingcost/{id} [DELETE]
func (p *AppHandlingCostController) deleteHandler(c *gin.Context) <span class="cov0" title="0">{
        id := c.Param("id")

        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        <span class="cov0" title="0">err = p.appHandlingCostUC.DeleteById(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponseMessage{
                Message: "successfully delete app handling cost",
        }
        c.JSON(200, response)</span>
}

// @Summary Update Handling Cost
// @Description Create New Apps Handling Cost Data
// @Tags Handling Cost
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body model.AppHandlingCost true "Data application handling cost"
// @Success 200 {object} dto.ResponseMessage
// @Router /apphandlingcost [PUT]
func (p *AppHandlingCostController) updateHandler(c *gin.Context) <span class="cov0" title="0">{
        var app model.AppHandlingCost
        if err := c.ShouldBindJSON(&amp;app); err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        <span class="cov0" title="0">err = p.appHandlingCostUC.Update(app)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">response := dto.ResponseMessage{
                Message: "successfully update",
        }
        c.JSON(200, response)</span>
}

func NewAppHandlingCostController(appHandlingCostUC usecase.AppHandlingCostUsecase, rg *gin.RouterGroup) *AppHandlingCostController <span class="cov0" title="0">{
        return &amp;AppHandlingCostController{
                appHandlingCostUC: appHandlingCostUC,
                rg:                rg,
        }
}</span>
</pre>
		
		<pre class="file" id="file1" style="display: none">package api

import (
        "polen/delivery/middleware"
        "polen/model/dto"
        "polen/usecase"
        "strconv"

        "github.com/gin-gonic/gin"
)

type AuthController struct {
        userUC usecase.UserUseCase
        authUC usecase.AuthUseCase
        rg     *gin.RouterGroup
}

// @Summary Login
// @Description Login for User
// @Tags User
// @Accept json
// @Produce json
// @Param request body dto.AuthLoginRequest true "Data login user"
// @Success 200 {object} dto.ResponseData
// @Router /auth/login [post]
func (a *AuthController) loginHandler(c *gin.Context) <span class="cov8" title="1">{
        var data dto.AuthLoginRequest
        if err := c.ShouldBindJSON(&amp;data); err != nil </span><span class="cov8" title="1">{
                c.AbortWithStatusJSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov8" title="1">authResponse, err := a.authUC.Login(data)
        if err != nil </span><span class="cov8" title="1">{
                c.AbortWithStatusJSON(500, gin.H{
                        "message": "Failed",
                })
                return
        }</span>

        <span class="cov8" title="1">response := dto.ResponseData{
                Message: "successfully login",
                Data:    authResponse,
        }

        c.JSON(200, response)</span>
        // c.JSON(200, response)
}

// @Summary Register
// @Description Register for User
// @Tags User
// @Accept json
// @Produce json
// @Param request body dto.AuthRequest true "Data registration user"
// @Success 200 {object} dto.ResponseMessage
// @Router /auth/register [post]
func (a *AuthController) registerHandler(c *gin.Context) <span class="cov8" title="1">{
        var auth dto.AuthRequest
        if err := c.ShouldBindJSON(&amp;auth); err != nil </span><span class="cov8" title="1">{
                c.AbortWithStatusJSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov8" title="1">err := a.userUC.Register(auth)
        if err != nil </span><span class="cov8" title="1">{
                c.AbortWithStatusJSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov8" title="1">response := dto.ResponseMessage{
                Message: "successfully register",
        }

        c.JSON(200, gin.H{
                "message": response.Message,
        })</span>
}

func (a *AuthController) showUserHandler(c *gin.Context) <span class="cov0" title="0">{
        name := c.Param("name")

        model, err := a.userUC.FindByUsername(name, c)
        if err != nil </span><span class="cov0" title="0">{
                c.AbortWithStatusJSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := gin.H{
                "message": "successfully getting data",
                "data": gin.H{
                        "id":       model.Id,
                        "username": model.Username,
                        "role":     model.Role,
                },
        }

        c.JSON(200, response)</span>
}

// @Summary Get All User
// @Description Getting All User
// @Tags User
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param page path int true "page of pagination"
// @Param size path int true "size of pagination"
// @Success 200 {object} dto.ResponsePaging
// @Router /user/{page}/{size} [GET]
func (a *AuthController) paggingUserHandler(c *gin.Context) <span class="cov0" title="0">{
        // Mengambil parameter dari URL
        page, _ := strconv.Atoi(c.Param("page"))
        size, _ := strconv.Atoi(c.Param("size"))

        // Memberikan nilai default jika parameter kosong
        if page == 0 </span><span class="cov0" title="0">{
                page = 1 // Nilai default untuk page
        }</span>

        <span class="cov0" title="0">if size == 0 </span><span class="cov0" title="0">{
                size = 10 // Nilai default untuk size
        }</span>
        <span class="cov0" title="0">payload := dto.PageRequest{
                Page: page,
                Size: size,
        }

        model, pagereturn, err := a.userUC.Paging(payload, c)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponsePaging{
                Message: "Success getting data",
                Data:    model,
                Paging:  pagereturn,
        }

        c.JSON(200, response)</span>
}

func (a *AuthController) Route() <span class="cov8" title="1">{
        a.rg.POST("/auth/login", a.loginHandler)
        a.rg.POST("/auth/register", a.registerHandler)
        a.rg.GET("/usercred/:name", middleware.AuthMiddleware(), a.showUserHandler)
        a.rg.GET("/user/:page/:size", middleware.AuthMiddleware(), a.paggingUserHandler)
}</span>

func NewAuthController(userUC usecase.UserUseCase, authUC usecase.AuthUseCase, rg *gin.RouterGroup) *AuthController <span class="cov8" title="1">{
        return &amp;AuthController{
                userUC: userUC,
                authUC: authUC,
                rg:     rg,
        }
}</span>
</pre>
		
		<pre class="file" id="file2" style="display: none">package api

import (
        "polen/delivery/middleware"
        "polen/model/dto"
        "polen/usecase"
        "polen/utils/common"
        "strconv"

        "github.com/gin-gonic/gin"
)

type BiodataUserController struct {
        biodataUC usecase.BiodataUserUseCase
        rg        *gin.RouterGroup
}

// @Summary Detail Biodata User
// @Description Get detail Biodata
// @Tags Biodata
// @Accept json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Produce json
// @Success 200 {object} dto.BiodataResponse
// @Router /biodata [GET]
func (u *BiodataUserController) listHandler(c *gin.Context) <span class="cov0" title="0">{
        biodata, err := u.biodataUC.FindByUserCredential(c)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">c.JSON(200, biodata)</span>
}

// @Summary Find User Updated
// @Description Find User Which has Been Updated the Biodata
// @Tags Biodata
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Success 200 {object} dto.ResponseData
// @Router /biodata/updated [GET]
func (u *BiodataUserController) listUserUpdated(c *gin.Context) <span class="cov0" title="0">{
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        <span class="cov0" title="0">biodata, err := u.biodataUC.FindUserUpdated()
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        // "message": err.Error(),
                        "message": "internal server error",
                })
                return
        }</span>
        <span class="cov0" title="0">response := dto.ResponseData{
                Message: "Successfully Getting Data",
                Data:    biodata,
        }

        c.JSON(200, response)</span>
}

// @Summary Find User Updated
// @Description Find User Which has Been Updated the Biodata
// @Tags Biodata
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body dto.UpdateBioRequest true "data vefication user"
// @Success 200 {object} dto.ResponseMessage
// @Router /biodata/verified [PUT]
func (u *BiodataUserController) updateAdmin(c *gin.Context) <span class="cov0" title="0">{
        var req dto.UpdateBioRequest
        if err := c.ShouldBindJSON(&amp;req); err != nil </span><span class="cov0" title="0">{
                c.JSON(422, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        <span class="cov0" title="0">code, err := u.biodataUC.AdminUpdate(req, c)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "Internal Server Error",
                })
                return
        }</span>
        <span class="cov0" title="0">response := dto.ResponseMessage{
                Message: "successfully update verification user",
        }
        c.JSON(code, response)</span>
}

// @Summary Update Biodata
// @Description Do Update User Biodata
// @Tags Biodata
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body dto.BiodataRequest true "data biodata user"
// @Success 200 {object} dto.ResponseMessage
// @Router /biodata/update [PUT]
func (u *BiodataUserController) updateUser(c *gin.Context) <span class="cov0" title="0">{
        var biodata dto.BiodataRequest
        if err := c.ShouldBindJSON(&amp;biodata); err != nil </span><span class="cov0" title="0">{
                c.JSON(422, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">code, err := u.biodataUC.UserUpdate(biodata, c)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(code, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">response := dto.ResponseMessage{
                Message: "successfully update biodata",
        }
        c.JSON(code, response)</span>
}

// @Summary Get all data
// @Description Do Update User Biodata
// @Tags Biodata
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param page path int true "page of pagination"
// @Param size path int true "size of pagination"
// @Success 200 {object} dto.ResponsePaging
// @Router /biodata/list/{page}/{size} [GET]
func (b *BiodataUserController) paggingBiodataHandler(c *gin.Context) <span class="cov0" title="0">{
        // get role
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }

        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        // Mengambil parameter dari URL
        <span class="cov0" title="0">page, _ := strconv.Atoi(c.Param("page"))
        size, _ := strconv.Atoi(c.Param("size"))

        // Memberikan nilai default jika parameter kosong
        if page == 0 </span><span class="cov0" title="0">{
                page = 1 // Nilai default untuk page
        }</span>

        <span class="cov0" title="0">if size == 0 </span><span class="cov0" title="0">{
                size = 10 // Nilai default untuk size
        }</span>
        <span class="cov0" title="0">payload := dto.PageRequest{
                Page: page,
                Size: size,
        }

        model, pagereturn, err := b.biodataUC.Paging(payload)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponsePaging{
                Message: "Success getting data",
                Data:    model,
                Paging:  pagereturn,
        }

        c.JSON(200, response)</span>
}

func (b *BiodataUserController) Route() <span class="cov0" title="0">{
        // b.rg.PUT("/biodata/update", middleware.AuthMiddleware(), b.createHandler)
        b.rg.GET("/biodata", middleware.AuthMiddleware(), b.listHandler)
        b.rg.GET("/biodata/updated", middleware.AuthMiddleware(), b.listUserUpdated)
        b.rg.PUT("/biodata/update", middleware.AuthMiddleware(), b.updateUser)
        b.rg.PUT("/biodata/verified", middleware.AuthMiddleware(), b.updateAdmin)
        b.rg.GET("/biodata/list/:page/:size", middleware.AuthMiddleware(), b.paggingBiodataHandler)
}</span>

func NewBiodataController(biodataUC usecase.BiodataUserUseCase, rg *gin.RouterGroup) *BiodataUserController <span class="cov0" title="0">{
        return &amp;BiodataUserController{
                biodataUC: biodataUC,
                rg:        rg,
        }
}</span>
</pre>
		
		<pre class="file" id="file3" style="display: none">package api

import (
        "fmt"
        "polen/delivery/middleware"
        "polen/model/dto"
        "polen/usecase"
        "polen/utils/common"
        "strconv"

        "github.com/gin-gonic/gin"
)

type DepositeController struct {
        depoUc usecase.DepositeUseCase
        rg     *gin.RouterGroup
}

// @Summary New deposito
// @Description Create New deposito Data
// @Tags Deposito
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body dto.DepositeRequest true "Data deposito"
// @Success 200 {object} dto.ResponseData
// @Router /deposite [POST]
func (d *DepositeController) createHandler(c *gin.Context) <span class="cov0" title="0">{
        // get credential
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "pemodal" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        <span class="cov0" title="0">ucid, err := common.GetId(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        // getting input
        <span class="cov0" title="0">var deposite dto.DepositeRequest
        if err := c.ShouldBindJSON(&amp;deposite); err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        // creating payload
        <span class="cov0" title="0">var payload dto.DepositeDto
        payload.UserCredential.Id = ucid
        payload.InterestRate.Id = deposite.InterestRateId
        payload.DepositeAmount = deposite.Amount
        // go to usecase
        code, err := d.depoUc.CreateDeposite(payload)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(code, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">response := dto.ResponseMessage{
                Message: "success creating data",
        }
        c.JSON(200, response)</span>
}

// @Summary get detail deposito user
// @Description Create New deposito Data
// @Tags Deposito
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Success 200 {object} dto.ResponseData
// @Router /deposite/user [GET]
func (d *DepositeController) getDepositeByUserHandler(c *gin.Context) <span class="cov0" title="0">{
        id, err := common.GetId(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">code, result, err := d.depoUc.FindByUcId(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(code, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return
        }</span>
        <span class="cov0" title="0">response := dto.ResponseData{
                Message: "success getting data",
                Data:    result,
        }
        c.JSON(200, response)</span>
}

// @Summary get deposito by id user
// @Description get deposito by id user
// @Tags Deposito
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param id path string true "Id ucredential user"
// @Success 200 {object} dto.ResponseData
// @Router /deposite/user/{id} [GET]
func (d *DepositeController) getDepositeByIdHandler(c *gin.Context) <span class="cov0" title="0">{
        // getting input
        id := c.Param("id")

        code, result, err := d.depoUc.FindById(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(code, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">response := dto.ResponseData{
                Message: "success getting data",
                Data:    result,
        }
        c.JSON(200, response)</span>
}

// @Summary get deposito by id
// @Description get deposito by id deposito
// @Tags Deposito
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param id path string true "Id deposito"
// @Success 200 {object} dto.ResponseData
// @Router /deposite/{id} [GET]
func (d *DepositeController) getDepositeByUserIdHandler(c *gin.Context) <span class="cov0" title="0">{
        // getting input
        id := c.Param("id")

        // get credential
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        <span class="cov0" title="0">code, result, err := d.depoUc.FindByUcId(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(code, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">response := dto.ResponseData{
                Message: "success getting data",
                Data:    result,
        }
        c.JSON(200, response)</span>
}

// @Summary Get all
// @Description get all data deposito
// @Tags Deposito
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param page path int true "page of pagination"
// @Param size path int true "size of pagination"
// @Success 200 {object} dto.ResponsePaging
// @Router /deposite/list/{page}/{size} [GET]
func (d *DepositeController) paggingHandler(c *gin.Context) <span class="cov0" title="0">{
        // Mengambil parameter dari URL
        page, _ := strconv.Atoi(c.Param("page"))
        size, _ := strconv.Atoi(c.Param("size"))

        // Memberikan nilai default jika parameter kosong
        if page == 0 </span><span class="cov0" title="0">{
                page = 1 // Nilai default untuk page
        }</span>

        <span class="cov0" title="0">if size == 0 </span><span class="cov0" title="0">{
                size = 10 // Nilai default untuk size
        }</span>
        <span class="cov0" title="0">payload := dto.PageRequest{
                Page: page,
                Size: size,
        }

        model, pagereturn, err := d.depoUc.Pagging(payload)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponsePaging{
                Message: "Success getting data",
                Data:    model,
                Paging:  pagereturn,
        }

        c.JSON(200, response)</span>
}

// @Summary update
// @Description update data deposito
// @Tags Deposito
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Success 200 {object} dto.ResponseData
// @Router /deposite/update [PUT]
func (d *DepositeController) updateHandler(c *gin.Context) <span class="cov0" title="0">{
        // get credential
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        // update
        <span class="cov0" title="0">fmt.Println("Melakukan pembaruan database...")
        defer fmt.Println("Selesai melakukan pembaruan data...")
        err = d.depoUc.Update()
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "sql: no rows in result set" </span><span class="cov0" title="0">{
                        c.JSON(200, gin.H{
                                "message": "Selesai melakukan pembaruan data",
                        })
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return</span>
        }
}

func (d *DepositeController) Route() <span class="cov0" title="0">{
        d.rg.POST("/deposite", middleware.AuthMiddleware(), d.createHandler)
        d.rg.GET("/deposite/user", middleware.AuthMiddleware(), d.getDepositeByUserHandler)
        d.rg.GET("/deposite/user/:id", middleware.AuthMiddleware(), d.getDepositeByUserIdHandler)
        d.rg.GET("/deposite/:id", middleware.AuthMiddleware(), d.getDepositeByIdHandler)
        d.rg.GET("/deposite/list/:page/:size", middleware.AuthMiddleware(), d.paggingHandler)
        d.rg.PUT("/deposite/update", middleware.AuthMiddleware(), d.updateHandler)
}</span>

func NewDepositeController(depoUc usecase.DepositeUseCase, rg *gin.RouterGroup) *DepositeController <span class="cov0" title="0">{
        return &amp;DepositeController{
                depoUc: depoUc,
                rg:     rg,
        }
}</span>
</pre>
		
		<pre class="file" id="file4" style="display: none">package api

import (
        "net/http"
        "polen/delivery/middleware"
        "polen/model/dto"
        "polen/usecase"
        "polen/utils/common"
        "strconv"

        "github.com/gin-gonic/gin"
        "github.com/google/uuid"
)

type DepositeInterestController struct {
        depositeUC usecase.DepositeInterestUseCase
        rg         *gin.RouterGroup
}

// @Summary new
// @Description create new data deposito interest
// @Tags deposito interest
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body dto.DepositeInterestReq true "Data deposite interest"
// @Success 200 {object} dto.ResponseData
// @Router /depositeinterest [POST]
func (d *DepositeInterestController) createHandler(c *gin.Context) <span class="cov0" title="0">{
        var payload dto.DepositeInterestReq
        var deposite dto.DepositeInterestRequest
        if err := c.ShouldBindJSON(&amp;deposite); err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        <span class="cov0" title="0">deposite.Id = uuid.NewString()
        deposite.InterestRate = payload.InterestRate
        deposite.DurationMounth = payload.DurationMounth
        deposite.TaxRate = payload.TaxRate
        code, err := d.depositeUC.CreateNew(deposite)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(code, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">resutl := dto.ResponseData{
                Message: "success creating data",
                Data:    deposite,
        }
        c.JSON(http.StatusCreated, resutl)</span>
}

// @Summary Get all
// @Description get all data deposito interest
// @Tags deposito interest
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param page path int true "page of pagination"
// @Param size path int true "size of pagination"
// @Success 200 {object} dto.ResponsePaging
// @Router /depositeinterest/list/{page}/{size} [GET]
func (d *DepositeInterestController) paggingHandler(c *gin.Context) <span class="cov0" title="0">{
        // Mengambil parameter dari URL
        page, _ := strconv.Atoi(c.Param("page"))
        size, _ := strconv.Atoi(c.Param("size"))

        // Memberikan nilai default jika parameter kosong
        if page == 0 </span><span class="cov0" title="0">{
                page = 1 // Nilai default untuk page
        }</span>

        <span class="cov0" title="0">if size == 0 </span><span class="cov0" title="0">{
                size = 10 // Nilai default untuk size
        }</span>
        <span class="cov0" title="0">payload := dto.PageRequest{
                Page: page,
                Size: size,
        }

        model, pagereturn, err := d.depositeUC.Pagging(payload)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponsePaging{
                Message: "Success getting data",
                Data:    model,
                Paging:  pagereturn,
        }

        c.JSON(200, response)</span>
}

func (d *DepositeInterestController) Route() <span class="cov0" title="0">{
        d.rg.POST("/depositeinterest", middleware.AuthMiddleware(), d.createHandler)
        d.rg.GET("/depositeinterest/list/:page/:size", middleware.AuthMiddleware(), d.paggingHandler)
        d.rg.PUT("/depositeinterest/", middleware.AuthMiddleware(), d.updateHandler)
        d.rg.DELETE("/depositeinterest/:id", middleware.AuthMiddleware(), d.deleteHandler)

}</span>

// @Summary delete
// @Description delete data deposito interest
// @Tags deposito interest
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param id path string true "id"
// @Success 200 {object} dto.ResponseMessage
// @Router /depositeinterest/{id} [DELETE]
func (d *DepositeInterestController) deleteHandler(c *gin.Context) <span class="cov0" title="0">{
        id := c.Param("id")

        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        <span class="cov0" title="0">err = d.depositeUC.DeleteById(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">result := dto.ResponseMessage{
                Message: "successfully delete deposite",
        }
        c.JSON(http.StatusCreated, result)</span>
}

// @Summary update
// @Description update data deposito interest
// @Tags deposito interest
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body dto.DepositeInterestRequest true "Data deposite interest"
// @Success 200 {object} dto.ResponseData
// @Router /depositeinterest [PUT]
func (d *DepositeInterestController) updateHandler(c *gin.Context) <span class="cov0" title="0">{
        var deposite dto.DepositeInterestRequest
        if err := c.ShouldBindJSON(&amp;deposite); err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        <span class="cov0" title="0">err = d.depositeUC.Update(deposite)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">result := dto.ResponseMessage{
                Message: "successfully update",
        }
        c.JSON(http.StatusCreated, result)</span>
}
func NewDepositeInterestController(depositeinterestUC usecase.DepositeInterestUseCase, rg *gin.RouterGroup) *DepositeInterestController <span class="cov0" title="0">{
        return &amp;DepositeInterestController{
                depositeUC: depositeinterestUC,
                rg:         rg,
        }
}</span>
</pre>
		
		<pre class="file" id="file5" style="display: none">package api

import (
        "net/http"
        "polen/delivery/middleware"
        "polen/model"
        "polen/model/dto"
        "polen/usecase"
        "polen/utils/common"
        "strconv"

        "github.com/gin-gonic/gin"
        "github.com/google/uuid"
)

type LatePaymentFeeController struct {
        LatePaymentFeeUC usecase.LatePaymentFeeUsecase
        rg               *gin.RouterGroup
}

// @Summary new
// @Description create new data late fee payment
// @Tags late fee payment
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body dto.LatePaymentFeeReq true "Data late fee"
// @Success 200 {object} dto.ResponseData
// @Router /latepaymentfee [POST]
func (p *LatePaymentFeeController) createHandler(c *gin.Context) <span class="cov0" title="0">{
        var app dto.LatePaymentFeeReq
        var payload model.LatePaymentFee
        payload.Name = app.Name
        payload.Nominal = app.Nominal
        payload.Unit = app.Unit
        if err := c.ShouldBindJSON(&amp;app); err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        <span class="cov0" title="0">payload.Id = uuid.NewString()
        code, err := p.LatePaymentFeeUC.CreateNew(payload)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(code, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">result := dto.ResponseData{
                Message: "success creating data",
                Data:    payload,
        }
        c.JSON(http.StatusCreated, result)</span>
}

// @Summary get all
// @Description get all data late fee payment
// @Tags late fee payment
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param page path int true "page of pagination"
// @Param size path int true "size of pagination"
// @Success 200 {object} dto.ResponsePaging
// @Router /latepaymentfee/list/{page}/{size} [GET]
func (p *LatePaymentFeeController) paggingHandler(c *gin.Context) <span class="cov0" title="0">{
        // Mengambil parameter dari URL
        page, _ := strconv.Atoi(c.Param("page"))
        size, _ := strconv.Atoi(c.Param("size"))

        // Memberikan nilai default jika parameter kosong
        if page == 0 </span><span class="cov0" title="0">{
                page = 1 // Nilai default untuk page
        }</span>

        <span class="cov0" title="0">if size == 0 </span><span class="cov0" title="0">{
                size = 10 // Nilai default untuk size
        }</span>
        <span class="cov0" title="0">payload := dto.PageRequest{
                Page: page,
                Size: size,
        }

        model, pagereturn, err := p.LatePaymentFeeUC.Pagging(payload)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponsePaging{
                Message: "Success getting data",
                Data:    model,
                Paging:  pagereturn,
        }

        c.JSON(200, response)</span>
}

func (p *LatePaymentFeeController) Route() <span class="cov0" title="0">{
        p.rg.POST("/latepaymentfee", middleware.AuthMiddleware(), p.createHandler)
        p.rg.GET("/latepaymentfee/list/:page/:size", middleware.AuthMiddleware(), p.paggingHandler)
        p.rg.PUT("/latepaymentfee/", middleware.AuthMiddleware(), p.updateHandler)
        p.rg.DELETE("/latepaymentfee/:id", middleware.AuthMiddleware(), p.deleteHandler)

}</span>

// @Summary delete
// @Description delete data late fee payment
// @Tags late fee payment
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param id path string true "id"
// @Success 200 {object} dto.ResponseMessage
// @Router /latepaymentfee/{id} [DELETE]
func (p *LatePaymentFeeController) deleteHandler(c *gin.Context) <span class="cov0" title="0">{
        id := c.Param("id")

        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        <span class="cov0" title="0">err = p.LatePaymentFeeUC.DeleteById(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">result := dto.ResponseMessage{
                Message: "success creating data",
        }
        c.JSON(http.StatusCreated, result)</span>
}

// @Summary update
// @Description update data late fee payment
// @Tags late fee payment
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body model.LatePaymentFee true "Data late fee"
// @Success 200 {object} dto.ResponseMessage
// @Router /latepaymentfee [PUT]
func (p *LatePaymentFeeController) updateHandler(c *gin.Context) <span class="cov0" title="0">{
        var app model.LatePaymentFee
        if err := c.ShouldBindJSON(&amp;app); err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        <span class="cov0" title="0">err = p.LatePaymentFeeUC.Update(app)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">result := dto.ResponseMessage{
                Message: "success creating data",
        }
        c.JSON(http.StatusCreated, result)</span>
}

func NewLatePaymentFeeController(LatePaymentFeeUC usecase.LatePaymentFeeUsecase, rg *gin.RouterGroup) *LatePaymentFeeController <span class="cov0" title="0">{
        return &amp;LatePaymentFeeController{
                LatePaymentFeeUC: LatePaymentFeeUC,
                rg:               rg,
        }
}</span>
</pre>
		
		<pre class="file" id="file6" style="display: none">package api

import (
        "fmt"
        "net/http"
        "os"
        "path/filepath"
        "polen/delivery/middleware"
        "polen/model/dto"
        "polen/usecase"
        "polen/utils/common"
        "time"

        "github.com/gin-gonic/gin"
)

type LoanController struct {
        loanUC usecase.LoanUseCase
        rg     *gin.RouterGroup
}

// @Summary new
// @Description create new data loan
// @Tags loan
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body dto.LoanReq true "Data deposite interest"
// @Success 200 {object} dto.ResponseMessage
// @Router /loan [POST]
func (l *LoanController) createHandler(c *gin.Context) <span class="cov0" title="0">{
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "peminjam" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        <span class="cov0" title="0">ucid, err := common.GetId(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">var data dto.LoanReq
        var payload dto.LoanRequest
        payload.LoanAmount = data.LoanAmount
        payload.LoanHandlingCostId = data.LoanHandlingCostId
        payload.LoanInterestRateId = data.LoanInterestRateId
        payload.LoanLatePaymentFessId = data.LoanLatePaymentFessId
        payload.UserCredentialId = ucid
        if err := c.ShouldBindJSON(&amp;data); err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">code, err := l.loanUC.Create(payload)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(code, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">result := dto.ResponseMessage{
                Message: "success creating data",
        }
        c.JSON(http.StatusCreated, result)</span>
}

// @Summary find by id installenment
// @Description find by id data loan
// @Tags installenment loan
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param id path string true "id"
// @Success 200 {object} dto.ResponseMessage
// @Router /loan/installment/:id [GET]
func (l *LoanController) findById(c *gin.Context) <span class="cov0" title="0">{
        id := c.Param("id")

        data, err := l.loanUC.FindById(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">result := dto.ResponseData{
                Message: "Success getting data",
                Data:    data,
        }
        c.JSON(200, result)</span>
}

// @Summary find by id loan
// @Description find by id data loan
// @Tags loan
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param id path string true "id"
// @Success 200 {object} dto.ResponseMessage
// @Router /loan/{id} [GET]
func (l *LoanController) loanid(c *gin.Context) <span class="cov0" title="0">{
        id := c.Param("id")

        data, err := l.loanUC.FindByLoanId(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponseData{
                Message: "Success getting data",
                Data:    data,
        }
        c.JSON(200, response)</span>
}

// @Summary upload
// @Description upload recipe
// @Tags loan
// @Accept mpfd
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param file formData file true "File to upload"
// @Param id formData string true "ID parameter"
// @Success 200 {object} dto.ResponseMessage
// @Router /loan/pay [POST]
func (t *LoanController) Upload(c *gin.Context) <span class="cov0" title="0">{
        // ambil role
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">fmt.Println(role)

        // cek apakah user adalah admin
        if role != "peminjam" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        // get user credential
        <span class="cov0" title="0">iduc, err := common.GetId(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }

        <span class="cov0" title="0">var payload dto.LoanInstallenmentResponse
        file, err := c.FormFile("file")
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        // Membuat nama file unik dengan menambahkan timestamp di belakangnya
        <span class="cov0" title="0">fileName := filepath.Base(file.Filename)
        fileExt := filepath.Ext(fileName)
        timestamp := time.Now().Format("20060102150405") // Format timestamp yang diinginkan (YYYYMMDDHHmmss)
        uniqueFileName := fileName[:len(fileName)-len(fileExt)] + "_" + timestamp + fileExt

        // Menggunakan path file yang aman
        filePath := "uploads/" + uniqueFileName

        id := c.PostForm("id")

        // payload
        payload.File = filePath
        payload.Id = id

        if err := c.SaveUploadedFile(file, filePath); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov0" title="0">code, err := t.loanUC.UploadFile(iduc, payload)
        if err != nil </span><span class="cov0" title="0">{
                _ = os.Remove(payload.File)
                c.JSON(code, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponseMessage{
                Message: "Success upload data",
        }
        c.JSON(200, response)</span>
}

// @Summary get data upoaded
// @Description upload recipe
// @Tags loan
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Success 200 {object} dto.ResponseMessage
// @Router /loan/updatedpayment [GET]
func (t *LoanController) GetUploaded(c *gin.Context) <span class="cov0" title="0">{
        // ambil role
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">fmt.Println(role)

        // cek apakah user adalah admin
        if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        <span class="cov0" title="0">data, err := t.loanUC.FindUploadedFile()
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">response := dto.ResponseData{
                Message: "success grtting data",
                Data:    data,
        }
        c.JSON(http.StatusOK, response)</span>
}

// @Summary confirm
// @Description confirm data uploaded
// @Tags loan
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body dto.Confirm true "Data late fee"
// @Success 200 {object} dto.ResponseMessage
// @Router /loan/confirm [PUT]
func (t *LoanController) confirm(c *gin.Context) <span class="cov0" title="0">{
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        <span class="cov0" title="0">var payload dto.Confirm
        if err := c.ShouldBindJSON(&amp;payload); err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">err = t.loanUC.Accepted(dto.InstallenmentLoanByIdResponse{
                LoanInst: dto.LoanInstallenmentResponse{
                        Id:      payload.Id,
                        IsPayed: payload.IsPayed,
                        Status:  payload.Status,
                },
        })
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">response := dto.ResponseMessage{
                Message: "updated",
        }
        c.JSON(200, response)</span>
}

// @Summary update
// @Description create update data late fee
// @Tags loan
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Success 200 {object} dto.ResponseMessage
// @Router /loan/updatelatefee [GET]
func (t *LoanController) latefee(c *gin.Context) <span class="cov0" title="0">{
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        <span class="cov0" title="0">err = t.loanUC.UpdateLateFee()
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">response := dto.ResponseMessage{
                Message: "updated",
        }
        c.JSON(200, response)</span>
}

func (l *LoanController) Route() <span class="cov0" title="0">{
        l.rg.POST("/loan", middleware.AuthMiddleware(), l.createHandler)
        l.rg.GET("/loan/installment/:id", middleware.AuthMiddleware(), l.findById)
        l.rg.POST("/loan/pay", middleware.AuthMiddleware(), l.Upload)
        l.rg.GET("/loan/updatedpayment", middleware.AuthMiddleware(), l.GetUploaded)
        l.rg.PUT("/loan/confirm", middleware.AuthMiddleware(), l.confirm)
        l.rg.PUT("/loan/updatelatefee", middleware.AuthMiddleware(), l.latefee)
        l.rg.GET("/loan/:id", middleware.AuthMiddleware(), l.loanid)
}</span>

func NewLoanController(loanUC usecase.LoanUseCase, rg *gin.RouterGroup) *LoanController <span class="cov0" title="0">{
        return &amp;LoanController{
                loanUC: loanUC,
                rg:     rg,
        }
}</span>
</pre>
		
		<pre class="file" id="file7" style="display: none">package api

import (
        "fmt"
        "net/http"
        "polen/delivery/middleware"
        "polen/model"
        "polen/model/dto"
        "polen/usecase"
        "polen/utils/common"
        "strconv"

        "github.com/gin-gonic/gin"
)

type LoanInterestController struct {
        loanInterestUC usecase.LoanInterestUseCase
        rg             *gin.RouterGroup
}

// @Summary new
// @Description create new data loan interest
// @Tags loan interest
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body dto.LoanInterest true "Data loan interest"
// @Success 200 {object} dto.ResponseData
// @Router /loaninterest [POST]
func (l *LoanInterestController) createHandler(c *gin.Context) <span class="cov0" title="0">{
        var data dto.LoanInterest
        var loanInterest model.LoanInterest
        if err := c.ShouldBindJSON(&amp;data); err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">loanInterest.LoanInterestRate = data.LoanInterestRate
        loanInterest.DurationMonths = data.DurationMonths

        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        <span class="cov0" title="0">loanInterest.Id = common.GenerateID()
        fmt.Println(loanInterest)
        code, err := l.loanInterestUC.CreateNew(loanInterest)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(code, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">respone := dto.ResponseData{
                Message: "success creating data",
                Data:    loanInterest,
        }
        c.JSON(http.StatusCreated, respone)</span>
}

// @Summary get all
// @Description get all data loan interest
// @Tags loan interest
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param page path int true "page of pagination"
// @Param size path int true "size of pagination"
// @Success 200 {object} dto.ResponsePaging
// @Router /loaninterest/list/{page}/{size} [GET]
func (l *LoanInterestController) paggingHandler(c *gin.Context) <span class="cov0" title="0">{
        // Mengambil parameter dari URL
        page, _ := strconv.Atoi(c.Param("page"))
        size, _ := strconv.Atoi(c.Param("size"))

        // Memberikan nilai default jika parameter kosong
        if page == 0 </span><span class="cov0" title="0">{
                page = 1 // Nilai default untuk page
        }</span>

        <span class="cov0" title="0">if size == 0 </span><span class="cov0" title="0">{
                size = 10 // Nilai default untuk size
        }</span>
        <span class="cov0" title="0">payload := dto.PageRequest{
                Page: page,
                Size: size,
        }

        model, pagereturn, err := l.loanInterestUC.Pagging(payload)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponsePaging{
                Message: "Success getting data",
                Data:    model,
                Paging:  pagereturn,
        }

        c.JSON(200, response)</span>
}

func (l *LoanInterestController) Route() <span class="cov0" title="0">{
        l.rg.POST("/loaninterest", middleware.AuthMiddleware(), l.createHandler)
        l.rg.GET("/loaninterest/list/:page/:size", middleware.AuthMiddleware(), l.paggingHandler)
        l.rg.PUT("/loaninterest", middleware.AuthMiddleware(), l.updateHandler)
        l.rg.DELETE("/loaninterest/:id", middleware.AuthMiddleware(), l.deleteHandler)

}</span>

// @Summary get all
// @Description get all data loan interest
// @Tags loan interest
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param id path string true "id"
// @Success 200 {object} dto.ResponsePaging
// @Router /loaninterest/{id} [DELETE]
func (l *LoanInterestController) deleteHandler(c *gin.Context) <span class="cov0" title="0">{
        id := c.Param("id")

        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        <span class="cov0" title="0">err = l.loanInterestUC.DeleteById(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">respone := dto.ResponseMessage{
                Message: "successfully delete loan interest",
        }
        c.JSON(http.StatusCreated, respone)</span>
}

// @Summary update
// @Description create update data loan interest
// @Tags loan interest
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body model.LoanInterest true "Data loan interest"
// @Success 200 {object} dto.ResponseMessage
// @Router /loaninterest [PUT]
func (l *LoanInterestController) updateHandler(c *gin.Context) <span class="cov0" title="0">{
        var loan model.LoanInterest
        if err := c.ShouldBindJSON(&amp;loan); err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        <span class="cov0" title="0">err = l.loanInterestUC.Update(loan)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">respone := dto.ResponseMessage{
                Message: "success update data",
        }
        c.JSON(http.StatusCreated, respone)</span>
}

func NewLoanInterestController(loanInterestUC usecase.LoanInterestUseCase, rg *gin.RouterGroup) *LoanInterestController <span class="cov0" title="0">{
        return &amp;LoanInterestController{
                loanInterestUC: loanInterestUC,
                rg:             rg,
        }
}</span>
</pre>
		
		<pre class="file" id="file8" style="display: none">package api

import (
        "polen/delivery/middleware"
        "polen/model/dto"
        "polen/usecase"
        "polen/utils/common"
        "strconv"

        "github.com/gin-gonic/gin"
)

type SaldoController struct {
        saldoUC usecase.SaldoUsecase
        rg      *gin.RouterGroup
}

// @Summary get all
// @Description get all data saldo
// @Tags saldo
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param page path int true "page of pagination"
// @Param size path int true "size of pagination"
// @Success 200 {object} dto.ResponsePaging
// @Router /saldo/list/{page}/{size} [GET]
func (s *SaldoController) paggingHandler(c *gin.Context) <span class="cov0" title="0">{
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        // Mengambil parameter dari URL
        <span class="cov0" title="0">page, _ := strconv.Atoi(c.Param("page"))
        size, _ := strconv.Atoi(c.Param("size"))

        // Memberikan nilai default jika parameter kosong
        if page == 0 </span><span class="cov0" title="0">{
                page = 1 // Nilai default untuk page
        }</span>

        <span class="cov0" title="0">if size == 0 </span><span class="cov0" title="0">{
                size = 10 // Nilai default untuk size
        }</span>
        <span class="cov0" title="0">payload := dto.PageRequest{
                Page: page,
                Size: size,
        }

        model, pagereturn, err := s.saldoUC.Pagging(payload)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponsePaging{
                Message: "Success getting data",
                Data:    model,
                Paging:  pagereturn,
        }

        c.JSON(200, response)</span>
}

// @Summary get by id installenment
// @Description get by id data loan
// @Tags saldo
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Success 200 {object} dto.ResponseData
// @Router /saldo [GET]
func (s *SaldoController) showSaldoUser(c *gin.Context) <span class="cov0" title="0">{
        ucid, err := common.GetId(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }

        <span class="cov0" title="0">model, err := s.saldoUC.FindByIdUser(ucid)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponseData{
                Message: "Success getting data",
                Data:    model,
        }

        c.JSON(200, response)</span>
}

// @Summary get by id installenment
// @Description get by id data loan
// @Tags saldo
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param id path int true "id"
// @Success 200 {object} dto.ResponseData
// @Router /saldo/{id} [GET]
func (s *SaldoController) showSaldoById(c *gin.Context) <span class="cov0" title="0">{
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        <span class="cov0" title="0">id := c.Param("id")

        model, err := s.saldoUC.FindByIdUser(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponseData{
                Message: "Success getting data",
                Data:    model,
        }

        c.JSON(200, response)</span>
}

func (s *SaldoController) Route() <span class="cov0" title="0">{
        s.rg.GET("/saldo", middleware.AuthMiddleware(), s.showSaldoUser)
        s.rg.GET("/saldo/:id", middleware.AuthMiddleware(), s.showSaldoById)
        s.rg.GET("/saldo/list/:page/:size", middleware.AuthMiddleware(), s.paggingHandler)
}</span>

func NewSaldoController(saldoUC usecase.SaldoUsecase, rg *gin.RouterGroup) *SaldoController <span class="cov0" title="0">{
        return &amp;SaldoController{
                saldoUC: saldoUC,
                rg:      rg,
        }
}</span>
</pre>
		
		<pre class="file" id="file9" style="display: none">package api

import (
        "fmt"
        "net/http"
        "os"
        "path/filepath"
        "polen/delivery/middleware"
        "polen/model/dto"
        "polen/usecase"
        "polen/utils/common"
        "strconv"
        "time"

        "github.com/gin-gonic/gin"
        "github.com/google/uuid"
)

type TopUpController struct {
        topupUC usecase.TopUpUseCase
        bioUc   usecase.BiodataUserUseCase
        rg      *gin.RouterGroup
}

// @Summary get by id user
// @Description get data top up by user id
// @Tags topup
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param id path int true "id"
// @Success 200 {object} dto.ResponseData
// @Router /topup/user/{id} [GET]
func (t *TopUpController) getByIdUserId(c *gin.Context) <span class="cov0" title="0">{
        id := c.Param("id")
        // ambil role
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        // jika bukan pemodal maka tidak boleh
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        <span class="cov0" title="0">data, err := t.topupUC.FindByIdUser(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">c.JSON(200, gin.H{
                "message": "success getting data",
                "data":    data,
        })</span>
}

// @Summary get by id data
// @Description get data top up by id data
// @Tags topup
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param id path int true "id"
// @Success 200 {object} dto.ResponseData
// @Router /topup/{id} [GET]
func (t *TopUpController) getById(c *gin.Context) <span class="cov0" title="0">{
        id := c.Param("id")
        data, err := t.topupUC.FindById(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponseData{
                Message: "success getting data",
                Data:    data,
        }
        c.JSON(200, response)</span>
}

// @Summary confirm
// @Description confirm data topup
// @Tags topup
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body dto.TopUpupdate true "Data top up"
// @Success 200 {object} dto.ResponseMessage
// @Router /topup/confirm [PUT]
func (t *TopUpController) ConfirmUpload(c *gin.Context) <span class="cov0" title="0">{
        // ambil role
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }

        // cek apakah user adalah admin
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        // ambil data request
        <span class="cov0" title="0">var data dto.TopUpupdate
        var topup dto.TopUpUser
        if err := c.ShouldBindJSON(&amp;data); err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">topup.Accepted = data.Accepted
        topup.Id = data.Id
        topup.Status = data.Status
        code, err := t.topupUC.ConfimUploadFile(topup)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(code, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">endresult := dto.ResponseMessage{
                Message: "success creating data",
        }
        c.JSON(http.StatusCreated, endresult)</span>
}

// @Summary get data updated
// @Description get updated data topup
// @Tags topup
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Success 200 {object} dto.ResponseData
// @Router /topup/confirm [GET]
func (t *TopUpController) UploadedFile(c *gin.Context) <span class="cov0" title="0">{
        // ambil role
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }

        // cek apakah user adalah admin
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        <span class="cov0" title="0">data, err := t.topupUC.FindUploadedFile()
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
        }</span>

        <span class="cov0" title="0">response := dto.ResponseData{
                Message: "success getting data",
                Data:    data,
        }
        c.JSON(200, response)</span>
}

// @Summary new
// @Description create new data topup
// @Tags topup
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param request body dto.TopUpReq true "Data topup"
// @Success 200 {object} dto.ResponseData
// @Router /topup [POST]
func (t *TopUpController) createHandler(c *gin.Context) <span class="cov0" title="0">{
        // ambil id
        ucid, err := common.GetId(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }

        // ambil role
        <span class="cov0" title="0">role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }

        // cek apakah user adalah pemodal
        <span class="cov0" title="0">if role != "pemodal" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>

        // cek apakah user sudah terkonfirmasi boleh melakukan top up
        <span class="cov0" title="0">bio, err := t.bioUc.FindByUserCredential(c)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>
        <span class="cov0" title="0">fmt.Println(bio.IsAglible, bio.Information)
        if !bio.IsAglible </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": []string{
                                "you are not allowed to di this transaction",
                                bio.Information,
                        },
                })
                return
        }</span>

        <span class="cov0" title="0">var data dto.TopUpReq
        var topup dto.TopUpUser
        if err := c.ShouldBindJSON(&amp;data); err != nil </span><span class="cov0" title="0">{
                c.JSON(400, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">topup.Id = uuid.NewString()
        topup.TopUpAmount = data.TopUpAmount
        topup.UserCredential.Id = ucid
        result, err := t.topupUC.CreateNew(topup)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">endresult := dto.ResponseData{
                Message: "success creating data",
                Data:    result,
        }
        c.JSON(http.StatusCreated, endresult)</span>
}

// @Summary get by user login
// @Description get data top up by user login
// @Tags topup
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Success 200 {object} dto.ResponseData
// @Router /topup/user [GET]
func (t *TopUpController) getByIdUserLoginHandler(c *gin.Context) <span class="cov0" title="0">{
        // ambil role
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        // jika bukan pemodal maka tidak boleh
        <span class="cov0" title="0">if role != "pemodal" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        // user id
        <span class="cov0" title="0">ucid, err := common.GetId(c)
        fmt.Println(ucid)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        // get data
        <span class="cov0" title="0">data, err := t.topupUC.FindByIdUser(ucid)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return
        }</span>
        <span class="cov0" title="0">response := dto.ResponseData{
                Message: "success getting data",
                Data:    data,
        }
        c.JSON(200, response)</span>
}

// @Summary upload
// @Description upload recipe
// @Tags topup
// @Accept mpfd
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param file formData file true "File to upload"
// @Param id formData string true "ID parameter"
// @Success 200 {object} dto.ResponseMessage
// @Router /topup/upload [POST]
func (t *TopUpController) UploadFile(c *gin.Context) <span class="cov0" title="0">{
        file, err := c.FormFile("file")
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        // Membuat nama file unik dengan menambahkan timestamp di belakangnya
        <span class="cov0" title="0">fileName := filepath.Base(file.Filename)
        fileExt := filepath.Ext(fileName)
        timestamp := time.Now().Format("20060102150405") // Format timestamp yang diinginkan (YYYYMMDDHHmmss)
        uniqueFileName := fileName[:len(fileName)-len(fileExt)] + "_" + timestamp + fileExt

        // Menggunakan path file yang aman
        filePath := "uploads/" + uniqueFileName

        id := c.PostForm("id")

        // get user credential
        iduc, err := common.GetId(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }

        // payload
        <span class="cov0" title="0">payload := dto.TopUpUser{
                Id:             id,
                File:           filePath,
                UserCredential: dto.GetAuthResponse{Id: iduc},
        }

        if err := c.SaveUploadedFile(file, filePath); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov0" title="0">code, err := t.topupUC.UploadFile(payload)
        if err != nil </span><span class="cov0" title="0">{
                _ = os.Remove(payload.File)
                c.JSON(code, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">endresult := dto.ResponseMessage{
                Message: "success uploaded data",
        }
        c.JSON(http.StatusCreated, endresult)</span>
}

// @Summary get all
// @Description get all data saldo
// @Tags topup
// @Accept json
// @Produce json
// @Param Authorization header string true "Bearer Token" default(Bearer &lt;token&gt;)
// @Param page path int true "page of pagination"
// @Param size path int true "size of pagination"
// @Success 200 {object} dto.ResponsePaging
// @Router /topup/list/{page}/{size} [GET]
func (t *TopUpController) paggingHandler(c *gin.Context) <span class="cov0" title="0">{
        role, err := common.GetRole(c)
        if err != nil </span><span class="cov0" title="0">{
                if err.Error() == "unautorized" </span><span class="cov0" title="0">{
                        c.JSON(401, gin.H{
                                "message": err.Error(),
                        })
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(500, gin.H{
                        "message": err.Error(),
                        // "message": "internal server error",
                })
                return</span>
        }
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                c.JSON(403, gin.H{
                        "message": "you are not allowed",
                })
                return
        }</span>
        // Mengambil parameter dari URL
        <span class="cov0" title="0">page, _ := strconv.Atoi(c.Param("page"))
        size, _ := strconv.Atoi(c.Param("size"))

        // Memberikan nilai default jika parameter kosong
        if page == 0 </span><span class="cov0" title="0">{
                page = 1 // Nilai default untuk page
        }</span>

        <span class="cov0" title="0">if size == 0 </span><span class="cov0" title="0">{
                size = 10 // Nilai default untuk size
        }</span>
        <span class="cov0" title="0">payload := dto.PageRequest{
                Page: page,
                Size: size,
        }

        model, pagereturn, err := t.topupUC.Pagging(payload)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(500, gin.H{
                        "message": err.Error(),
                })
                return
        }</span>

        <span class="cov0" title="0">response := dto.ResponsePaging{
                Message: "Success getting data",
                Data:    model,
                Paging:  pagereturn,
        }

        c.JSON(200, response)</span>
}

func (t *TopUpController) Route() <span class="cov0" title="0">{
        t.rg.POST("/topup", middleware.AuthMiddleware(), t.createHandler)
        t.rg.POST("/topup/upload", middleware.AuthMiddleware(), t.UploadFile)
        t.rg.PUT("/topup/confirm", middleware.AuthMiddleware(), t.ConfirmUpload)
        t.rg.GET("/topup/uploaded", middleware.AuthMiddleware(), t.UploadedFile)
        t.rg.GET("/topup/user/:id", middleware.AuthMiddleware(), t.getByIdUserId)
        t.rg.GET("/topup/:id", middleware.AuthMiddleware(), t.getById)
        t.rg.GET("/topup/user", middleware.AuthMiddleware(), t.getByIdUserLoginHandler)
        t.rg.GET("/topup/list/:page/:size", middleware.AuthMiddleware(), t.paggingHandler)
        // t.rg.PUT("/topup/update", t.updateHandler)

}</span>

func NewTopUpController(topupUC usecase.TopUpUseCase, bioUc usecase.BiodataUserUseCase, rg *gin.RouterGroup) *TopUpController <span class="cov0" title="0">{
        return &amp;TopUpController{
                topupUC: topupUC,
                rg:      rg,
                bioUc:   bioUc,
        }
}</span>
</pre>
		
		<pre class="file" id="file10" style="display: none">package repository

import (
        "database/sql"
        "math"
        "polen/model"
        "polen/model/dto"
)

type AppHandlingCost interface {
        CreateNew(payload model.AppHandlingCost) error
        FindById(id string) (model.AppHandlingCost, error)
        Pagging(payload dto.PageRequest) ([]model.AppHandlingCost, dto.Paging, error)
        Update(payload model.AppHandlingCost) error
        DeleteById(id string) error
}
type appHandlingCostRepository struct {
        db *sql.DB
}

// CreateNew implements AppHandlingCost.
func (a *appHandlingCostRepository) CreateNew(payload model.AppHandlingCost) error <span class="cov8" title="1">{
        _, err := a.db.Exec("INSERT INTO application_handling_cost VALUES ($1, $2, $3, $4)", payload.Id, payload.Name, payload.Nominal, payload.Unit)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">return nil</span>
}

// DeleteById implements AppHandlingCost.
func (a *appHandlingCostRepository) DeleteById(id string) error <span class="cov8" title="1">{
        _, err := a.db.Exec("DELETE FROM application_handling_cost WHERE id = $1", id)
        return err
}</span>

// FindById implements AppHandlingCost.
func (a *appHandlingCostRepository) FindById(id string) (model.AppHandlingCost, error) <span class="cov8" title="1">{
        row := a.db.QueryRow(`SELECT 
                id, 
                name,
                nominal,
                unit
        FROM 
                application_handling_cost
        WHERE id = $1`, id)
        AppHandlingCost := model.AppHandlingCost{}
        err := row.Scan(
                &amp;AppHandlingCost.Id,
                &amp;AppHandlingCost.Name,
                &amp;AppHandlingCost.Nominal,
                &amp;AppHandlingCost.Unit,
        )
        if err != nil </span><span class="cov8" title="1">{
                return model.AppHandlingCost{}, err
        }</span>
        <span class="cov8" title="1">return AppHandlingCost, nil</span>
}

// Pagging implements AppHandlingCost.
func (a *appHandlingCostRepository) Pagging(payload dto.PageRequest) ([]model.AppHandlingCost, dto.Paging, error) <span class="cov8" title="1">{
        if payload.Page &lt; 0 </span><span class="cov0" title="0">{
                payload.Page = 1
        }</span>
        <span class="cov8" title="1">query := `SELECT 
                id, 
                name,
                nominal,
                unit
        FROM 
                application_handling_cost
        LIMIT 
                $2 
        OFFSET 
                $1;
        `
        rows, err := a.db.Query(query, (payload.Page-1)*payload.Page, payload.Size)
        if err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()
        var data []model.AppHandlingCost
        for rows.Next() </span><span class="cov8" title="1">{
                var AppHandlingCost model.AppHandlingCost
                err := rows.Scan(
                        &amp;AppHandlingCost.Id,
                        &amp;AppHandlingCost.Name,
                        &amp;AppHandlingCost.Nominal,
                        &amp;AppHandlingCost.Unit,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, dto.Paging{}, err
                }</span>
                <span class="cov8" title="1">data = append(data, AppHandlingCost)</span>
        }

        <span class="cov8" title="1">var count int
        row := a.db.QueryRow("SELECT COUNT(id) FROM application_handling_cost")
        if err := row.Scan(&amp;count); err != nil </span><span class="cov0" title="0">{
                return nil, dto.Paging{}, err
        }</span>

        <span class="cov8" title="1">paging := dto.Paging{
                Page:       payload.Page,
                Size:       payload.Size,
                TotalRows:  count,
                TotalPages: int(math.Ceil(float64(count) / float64(payload.Size))),
        }

        return data, paging, nil</span>
}

// Update implements AppHandlingCost.
func (a *appHandlingCostRepository) Update(payload model.AppHandlingCost) error <span class="cov8" title="1">{
        _, err := a.db.Exec(`
                UPDATE 
                        application_handling_cost
                SET 
                        name = $2, 
                        nominal = $3,
                        unit =$4
                WHERE 
                        id = $1;`,
                payload.Id,
                payload.Name,
                payload.Nominal,
                payload.Unit,
        )
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">return nil</span>
}

func NewAppHandlingCostRepository(db *sql.DB) AppHandlingCost <span class="cov8" title="1">{
        return &amp;appHandlingCostRepository{
                db: db,
        }
}</span>
</pre>
		
		<pre class="file" id="file11" style="display: none">package repository

import (
        "database/sql"
        "math"
        "polen/model"
        "polen/model/dto"
)

type BiodataUser interface {
        FindUserUpdated() ([]dto.BiodataResponse, error)
        FindByUcId(id string) (dto.BiodataResponse, error)
        UserUpdate(payload model.BiodataUser) error
        AdminUpdate(payload model.BiodataUser) error
        Pagging(payload dto.PageRequest) ([]dto.BiodataResponse, dto.Paging, error)
}

type biodataUserRepository struct {
        db *sql.DB
}

// Pagging implements BiodataUser.
func (bio *biodataUserRepository) Pagging(payload dto.PageRequest) ([]dto.BiodataResponse, dto.Paging, error) <span class="cov8" title="1">{
        query := `SELECT 
                b.id, 
                        u.id, 
                        u.username, 
                        u.email, 
                        u.role, 
                        u.is_active, 
                        u.virtual_account_number,
                b.full_name, 
                b.nik, 
                b.phone_number, 
                b.occupation, 
                b.place_of_birth, 
                b.date_of_birth, 
                b.postal_code,
                b.is_eglible,
                b.status_update,
                b.additional_information
        FROM 
                biodata b 
        JOIN 
                user_credential u 
        ON 
                u.id = b.user_credential_id
        LIMIT 
                $2 
        OFFSET 
                $1;
        `
        rows, err := bio.db.Query(query, (payload.Page-1)*payload.Page, payload.Size)
        if err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()
        var data []dto.BiodataResponse
        for rows.Next() </span><span class="cov8" title="1">{
                var datum dto.BiodataResponse
                err := rows.Scan(
                        &amp;datum.Id,
                        &amp;datum.UserCredential.Id,
                        &amp;datum.UserCredential.Username,
                        &amp;datum.UserCredential.Email,
                        &amp;datum.UserCredential.Role,
                        &amp;datum.UserCredential.IsActive,
                        &amp;datum.UserCredential.VaNumber,
                        &amp;datum.NamaLengkap,
                        &amp;datum.Nik,
                        &amp;datum.NomorTelepon,
                        &amp;datum.Pekerjaan,
                        &amp;datum.TempatLahir,
                        &amp;datum.TanggalLahir,
                        &amp;datum.KodePos,
                        &amp;datum.IsAglible,
                        &amp;datum.StatusUpdate,
                        &amp;datum.Information,
                )
                datum.UserCredential.Password = "********"
                if err != nil </span><span class="cov0" title="0">{
                        return nil, dto.Paging{}, err
                }</span>
                <span class="cov8" title="1">data = append(data, datum)</span>
        }

        <span class="cov8" title="1">var count int
        row := bio.db.QueryRow("SELECT COUNT(id) FROM biodata")
        if err := row.Scan(&amp;count); err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>

        <span class="cov8" title="1">paging := dto.Paging{
                Page:       payload.Page,
                Size:       payload.Size,
                TotalRows:  count,
                TotalPages: int(math.Ceil(float64(count) / float64(payload.Size))),
        }

        return data, paging, nil</span>
}

// AdminUpdate implements BiodataUser.
func (bio *biodataUserRepository) AdminUpdate(payload model.BiodataUser) error <span class="cov8" title="1">{
        _, err := bio.db.Exec(`
        UPDATE biodata SET 
                        is_eglible = $2,
                        status_update = $3,
                        additional_information = $4
                WHERE id = $1`,
                payload.Id,
                payload.IsAglible,
                payload.StatusUpdate,
                payload.Information,
        )
        return err
}</span>

// UserUpdate implements BiodataUser.
func (bio *biodataUserRepository) UserUpdate(payload model.BiodataUser) error <span class="cov8" title="1">{
        _, err := bio.db.Exec(`
        UPDATE biodata SET 
                        user_credential_id = $2, 
                        full_name = $3, 
                        nik = $4, 
                        phone_number = $5, 
                        occupation = $6, 
                        place_of_birth = $7, 
                        date_of_birth = $8, 
                        postal_code = $9,
                        is_eglible = $10,
                        status_update = $11,
                        additional_information = $12
                WHERE id = $1`,
                payload.Id,
                payload.UserCredential.Id,
                payload.NamaLengkap,
                payload.Nik,
                payload.NomorTelepon,
                payload.Pekerjaan,
                payload.TempatLahir,
                payload.TanggalLahir,
                payload.KodePos,
                payload.IsAglible,
                payload.StatusUpdate,
                payload.Information,
        )
        return err
}</span>

// FindByUcId implements BiodataUser.
func (bio *biodataUserRepository) FindByUcId(id string) (dto.BiodataResponse, error) <span class="cov8" title="1">{
        row := bio.db.QueryRow(`
        SELECT 
                        b.id, 
                                u.id, 
                                u.username, 
                                u.email, 
                                u.role, 
                                u.is_active, 
                                u.virtual_account_number,
                        b.full_name, 
                        b.nik, 
                        b.phone_number, 
                        b.occupation, 
                        b.place_of_birth, 
                        b.date_of_birth, 
                        b.postal_code,
                        b.is_eglible,
                        b.status_update,
                        b.additional_information
                FROM 
                        biodata b 
                JOIN 
                        user_credential u 
                ON 
                        u.id = b.user_credential_id
                WHERE
                        b.user_credential_id = $1;
`, id)
        biodata := dto.BiodataResponse{}
        biodata.UserCredential.Password = "********"
        err := row.Scan(
                &amp;biodata.Id,
                &amp;biodata.UserCredential.Id,
                &amp;biodata.UserCredential.Username,
                &amp;biodata.UserCredential.Email,
                &amp;biodata.UserCredential.Role,
                &amp;biodata.UserCredential.IsActive,
                &amp;biodata.UserCredential.VaNumber,
                &amp;biodata.NamaLengkap,
                &amp;biodata.Nik,
                &amp;biodata.NomorTelepon,
                &amp;biodata.Pekerjaan,
                &amp;biodata.TempatLahir,
                &amp;biodata.TanggalLahir,
                &amp;biodata.KodePos,
                &amp;biodata.IsAglible,
                &amp;biodata.StatusUpdate,
                &amp;biodata.Information,
        )
        if err != nil </span><span class="cov8" title="1">{
                return dto.BiodataResponse{}, err
        }</span>
        <span class="cov8" title="1">return biodata, nil</span>
}

// FindByUcId implements BiodataUser.
func (bio *biodataUserRepository) FindUserUpdated() ([]dto.BiodataResponse, error) <span class="cov8" title="1">{
        rows, err := bio.db.Query(`
        SELECT 
                        b.id, 
                                u.id, 
                                u.username, 
                                u.email, 
                                u.role, 
                                u.is_active,
                                u.virtual_account_number,
                        b.full_name, 
                        b.nik, 
                        b.phone_number, 
                        b.occupation, 
                        b.place_of_birth, 
                        b.date_of_birth, 
                        b.postal_code,
                        b.is_eglible,
                        b.status_update,
                        b.additional_information
                FROM 
                        biodata b 
                JOIN 
                        user_credential u 
                ON 
                        u.id = b.user_credential_id
                WHERE
                        b.status_update = true
                        AND
                        b.is_eglible = false
`)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()

        var biodatas []dto.BiodataResponse
        for rows.Next() </span><span class="cov8" title="1">{
                biodata := dto.BiodataResponse{}
                biodata.UserCredential.Password = "********"
                err := rows.Scan(
                        &amp;biodata.Id,
                        &amp;biodata.UserCredential.Id,
                        &amp;biodata.UserCredential.Username,
                        &amp;biodata.UserCredential.Email,
                        &amp;biodata.UserCredential.Role,
                        &amp;biodata.UserCredential.IsActive,
                        &amp;biodata.UserCredential.VaNumber,
                        &amp;biodata.NamaLengkap,
                        &amp;biodata.Nik,
                        &amp;biodata.NomorTelepon,
                        &amp;biodata.Pekerjaan,
                        &amp;biodata.TempatLahir,
                        &amp;biodata.TanggalLahir,
                        &amp;biodata.KodePos,
                        &amp;biodata.IsAglible,
                        &amp;biodata.StatusUpdate,
                        &amp;biodata.Information,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">biodatas = append(biodatas, biodata)</span>
        }
        <span class="cov8" title="1">return biodatas, nil</span>
}

func NewBiodataUserRepository(db *sql.DB) BiodataUser <span class="cov8" title="1">{
        return &amp;biodataUserRepository{db: db}
}</span>
</pre>
		
		<pre class="file" id="file12" style="display: none">package repository

import (
        "database/sql"
        "math"
        "polen/model"
        "polen/model/dto"
)

type DepositeInterest interface {
        Save(payload model.DepositeInterest) error
        Pagging(payload dto.PageRequest) ([]dto.DepositeInterestRequest, dto.Paging, error)
        Update(payload dto.DepositeInterestRequest) error
        DeleteById(id string) error
        FindById(id string) (dto.DepositeInterestRequest, error)
}

type depositeInterest struct {
        db *sql.DB
}

func (d *depositeInterest) Pagging(payload dto.PageRequest) ([]dto.DepositeInterestRequest, dto.Paging, error) <span class="cov8" title="1">{
        query := `SELECT 
                id, 
                interest_rate,
                tax_rate,
                duration_mounth
        FROM 
                deposit_interest
        LIMIT 
                $2 
        OFFSET 
                $1;
        `
        rows, err := d.db.Query(query, (payload.Page-1)*payload.Page, payload.Size)
        if err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()
        var data []dto.DepositeInterestRequest
        for rows.Next() </span><span class="cov8" title="1">{
                var datum dto.DepositeInterestRequest
                err := rows.Scan(
                        &amp;datum.Id,
                        &amp;datum.InterestRate,
                        &amp;datum.TaxRate,
                        &amp;datum.DurationMounth,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, dto.Paging{}, err
                }</span>
                <span class="cov8" title="1">data = append(data, datum)</span>
        }

        <span class="cov8" title="1">var count int
        row := d.db.QueryRow("SELECT COUNT(id) FROM deposit_interest")
        if err := row.Scan(&amp;count); err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>

        <span class="cov8" title="1">paging := dto.Paging{
                Page:       payload.Page,
                Size:       payload.Size,
                TotalRows:  count,
                TotalPages: int(math.Ceil(float64(count) / float64(payload.Size))),
        }

        return data, paging, nil</span>
}

// DeleteById implements DepositeInterest.
func (d *depositeInterest) DeleteById(id string) error <span class="cov8" title="1">{
        _, err := d.db.Exec("DELETE FROM deposit_interest WHERE id = $1", id)
        return err
}</span>

// FindById implements DepositeInterest.
func (d *depositeInterest) FindById(id string) (dto.DepositeInterestRequest, error) <span class="cov8" title="1">{
        row := d.db.QueryRow(`SELECT 
                id, 
                interest_rate,
                tax_rate,
                duration_mounth
        FROM 
                deposit_interest 
        WHERE id =$1`, id)
        deposite := dto.DepositeInterestRequest{}
        err := row.Scan(
                &amp;deposite.Id,
                &amp;deposite.InterestRate,
                &amp;deposite.TaxRate,
                &amp;deposite.DurationMounth,
        )
        if err != nil </span><span class="cov8" title="1">{
                return dto.DepositeInterestRequest{}, err
        }</span>
        <span class="cov8" title="1">return deposite, nil</span>
}

// Update implements DepositeInterest.
func (d *depositeInterest) Update(payload dto.DepositeInterestRequest) error <span class="cov8" title="1">{
        _, err := d.db.Exec(`
                UPDATE 
                        deposit_interest 
                SET 
                        interest_rate = $2, 
                        tax_rate = $3,
                        duration_mounth = $4
                WHERE 
                        id = $1;`,
                payload.Id,
                payload.InterestRate,
                payload.TaxRate,
                payload.DurationMounth,
        )
        return err
}</span>

// Save implements DepositeIntereset.
func (d *depositeInterest) Save(payload model.DepositeInterest) error <span class="cov8" title="1">{
        _, err := d.db.Exec("INSERT INTO deposit_interest VALUES ($1, $2, $3, $4, $5)", payload.Id, payload.CreateDate, payload.InterestRate, payload.TaxRate, payload.DurationMounth)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">return nil</span>
}

func NewDepositeInterestRepository(db *sql.DB) DepositeInterest <span class="cov8" title="1">{
        return &amp;depositeInterest{
                db: db,
        }
}</span>
</pre>
		
		<pre class="file" id="file13" style="display: none">package repository

import (
        "database/sql"
        "math"
        "polen/model"
        "polen/model/dto"
        "time"
)

type DepositeRepository interface {
        CreateDeposite(payload dto.DepositeDto) error
        FindByUcId(id string) (dto.DepositeByUserResponse, error)
        FindById(id string) (dto.DepositeByIdResponse, error)
        Pagging(payload dto.PageRequest) ([]dto.Deposite, dto.Paging, error)
        Update() error
}

type depositeRepository struct {
        db   *sql.DB
        user BiodataUser
}

// Update implements DepositeRepository.
func (d *depositeRepository) Update() error <span class="cov8" title="1">{
        rows, err := d.db.Query(`
                SELECT
                        id,
                        user_credential_id,
                        tax,
                        status,
                        total_return
                FROM
                        deposit
                WHERE
                        status = true
                AND
                        maturity_date &lt; now();
        `)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">defer rows.Close()
        var data []model.Deposite
        for rows.Next() </span><span class="cov8" title="1">{
                var datum model.Deposite
                err := rows.Scan(
                        &amp;datum.Id,
                        &amp;datum.UserCredentialId,
                        &amp;datum.Tax,
                        &amp;datum.Status,
                        &amp;datum.TotalReturn,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return err
                }</span>
                <span class="cov8" title="1">data = append(data, datum)</span>
        }

        // update data
        <span class="cov8" title="1">for _, v := range data </span><span class="cov8" title="1">{
                tx, _ := d.db.Begin()
                _, err = tx.Exec(
                        `
                        UPDATE 
                                deposit
                        SET 
                                status = false
                        WHERE 
                                id = $1;
                        `,
                        v.Id,
                )
                if err != nil </span><span class="cov0" title="0">{
                        tx.Rollback()
                }</span>
                <span class="cov8" title="1">_, err = tx.Exec(
                        // tambah saldo user
                        `
                        UPDATE saldo
                        SET total_saving = total_saving + $1
                        WHERE user_credential_id = $2;
                        `,
                        v.TotalReturn,
                        v.UserCredentialId,
                )
                if err != nil </span><span class="cov0" title="0">{
                        tx.Rollback()
                }</span>
                // kurangi sado perusahaan
                <span class="cov8" title="1">_, err = tx.Exec(
                        `
                        UPDATE saldo
                        SET total_saving = total_saving - $1 - $2
                        WHERE user_credential_id = $3;
                        `,
                        v.TotalReturn,
                        v.Tax,
                        "456",
                )
                if err != nil </span><span class="cov0" title="0">{
                        tx.Rollback()
                }</span>
                // tambah saldo pajak
                <span class="cov8" title="1">_, err = tx.Exec(
                        `
                        UPDATE saldo
                        SET total_saving = total_saving + $1
                        WHERE user_credential_id = $2;
                        `,
                        v.Tax,
                        "tax",
                )
                if err != nil </span><span class="cov0" title="0">{
                        tx.Rollback()
                }</span>
                <span class="cov8" title="1">tx.Commit()</span>
        }
        <span class="cov8" title="1">return nil</span>
}

// Pagging implements DepositeRepository.
func (d *depositeRepository) Pagging(payload dto.PageRequest) ([]dto.Deposite, dto.Paging, error) <span class="cov8" title="1">{
        query := `
        SELECT
                id,
                deposit_amount,
                interest_rate,
                tax_rate,
                duration,
                created_date,
                maturity_date,
                status,
                gross_profit,
                tax,
                net_profit,
                total_return
        FROM
                deposit
        LIMIT 
                $2 
        OFFSET 
                $1;
        `
        rows, err := d.db.Query(query, (payload.Page-1)*payload.Page, payload.Size)
        if err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()
        var data []dto.Deposite
        for rows.Next() </span><span class="cov8" title="1">{
                var datum dto.Deposite
                err := rows.Scan(
                        &amp;datum.Id,
                        &amp;datum.DepositeAmount,
                        &amp;datum.InterestRate,
                        &amp;datum.TaxRate,
                        &amp;datum.DurationMounth,
                        &amp;datum.CreateDate,
                        &amp;datum.MaturityDate,
                        &amp;datum.Status,
                        &amp;datum.GrossProfit,
                        &amp;datum.Tax,
                        &amp;datum.NetProfit,
                        &amp;datum.TotalReturn,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, dto.Paging{}, err
                }</span>
                <span class="cov8" title="1">data = append(data, datum)</span>
        }

        <span class="cov8" title="1">var count int
        row := d.db.QueryRow("SELECT COUNT(id) FROM deposit_interest")
        if err := row.Scan(&amp;count); err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>

        <span class="cov8" title="1">paging := dto.Paging{
                Page:       payload.Page,
                Size:       payload.Size,
                TotalRows:  count,
                TotalPages: int(math.Ceil(float64(count) / float64(payload.Size))),
        }

        return data, paging, nil</span>
}

// FindById implements DepositeRepository.
func (d *depositeRepository) FindById(id string) (dto.DepositeByIdResponse, error) <span class="cov0" title="0">{
        // get data
        var result dto.DepositeByIdResponse
        var ucid string
        row := d.db.QueryRow(`
                SELECT
                        id,
                        user_credential_id,
                        deposit_amount,
                        interest_rate,
                        tax_rate,
                        duration,
                        created_date,
                        maturity_date,
                        status,
                        gross_profit,
                        tax,
                        net_profit,
                        total_return
                FROM
                        deposit
                WHERE
                        id = $1;
        `, id)
        err := row.Scan(
                &amp;result.Deposite.Id,
                &amp;ucid,
                &amp;result.Deposite.DepositeAmount,
                &amp;result.Deposite.InterestRate,
                &amp;result.Deposite.TaxRate,
                &amp;result.Deposite.DurationMounth,
                &amp;result.Deposite.CreateDate,
                &amp;result.Deposite.MaturityDate,
                &amp;result.Deposite.Status,
                &amp;result.Deposite.GrossProfit,
                &amp;result.Deposite.Tax,
                &amp;result.Deposite.NetProfit,
                &amp;result.Deposite.TotalReturn,
        )
        if err != nil </span><span class="cov0" title="0">{
                return dto.DepositeByIdResponse{}, err
        }</span>
        // get biodata user
        <span class="cov0" title="0">bio, err := d.user.FindByUcId(ucid)
        if err != nil </span><span class="cov0" title="0">{
                return dto.DepositeByIdResponse{}, err
        }</span>
        <span class="cov0" title="0">result.BioUser = bio
        return result, err</span>
}

// FindByUcId implements DepositeRepository.
func (d *depositeRepository) FindByUcId(id string) (dto.DepositeByUserResponse, error) <span class="cov0" title="0">{
        // get biodata user
        bio, err := d.user.FindByUcId(id)
        if err != nil </span><span class="cov0" title="0">{
                return dto.DepositeByUserResponse{}, err
        }</span>
        <span class="cov0" title="0">var result dto.DepositeByUserResponse
        result.BioUser = bio
        // get data
        rows, err := d.db.Query(`
                SELECT
                        id,
                        deposit_amount,
                        interest_rate,
                        tax_rate,
                        duration,
                        created_date,
                        maturity_date,
                        status,
                        gross_profit,
                        tax,
                        net_profit,
                        total_return
                FROM
                        deposit
                WHERE
                        user_credential_id = $1;
        `, id)
        if err != nil </span><span class="cov0" title="0">{
                return dto.DepositeByUserResponse{}, err
        }</span>
        <span class="cov0" title="0">var data []dto.Deposite
        for rows.Next() </span><span class="cov0" title="0">{
                var datum dto.Deposite
                err := rows.Scan(
                        &amp;datum.Id,
                        &amp;datum.DepositeAmount,
                        &amp;datum.InterestRate,
                        &amp;datum.TaxRate,
                        &amp;datum.DurationMounth,
                        &amp;datum.CreateDate,
                        &amp;datum.MaturityDate,
                        &amp;datum.Status,
                        &amp;datum.GrossProfit,
                        &amp;datum.Tax,
                        &amp;datum.NetProfit,
                        &amp;datum.TotalReturn,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return dto.DepositeByUserResponse{}, err
                }</span>
                <span class="cov0" title="0">data = append(data, datum)</span>
        }
        <span class="cov0" title="0">result.Deposite = data
        return result, nil</span>
}

// CreateDeposite implements DepositeRepository.
func (d *depositeRepository) CreateDeposite(payload dto.DepositeDto) error <span class="cov8" title="1">{
        tx, err := d.db.Begin()
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">_, err = tx.Exec("INSERT INTO deposit VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13)",
                payload.Id,
                payload.UserCredential.Id,
                payload.DepositeAmount,
                payload.InterestRate.InterestRate,
                payload.InterestRate.TaxRate,
                payload.InterestRate.DurationMounth,
                time.Now(),
                payload.MaturityDate,
                payload.Status,
                payload.GrossProfit,
                payload.Tax,
                payload.NetProfit,
                payload.TotalReturn,
        )
        if err != nil </span><span class="cov8" title="1">{
                tx.Rollback()
                return err
        }</span>
        <span class="cov8" title="1">_, err = tx.Exec(
                `
                UPDATE saldo
                SET total_saving = total_saving - $1
                WHERE user_credential_id = $2;
                `,
                payload.DepositeAmount,
                payload.UserCredential.Id,
        )
        if err != nil </span><span class="cov8" title="1">{
                tx.Rollback()
                return err
        }</span>
        <span class="cov8" title="1">_, err = tx.Exec(
                `
                UPDATE saldo
                SET total_saving = total_saving + $1
                WHERE user_credential_id = 456;
                `,
                payload.DepositeAmount,
                payload.UserCredential.Id,
        )
        if err != nil </span><span class="cov8" title="1">{
                tx.Rollback()
                return err
        }</span>
        <span class="cov8" title="1">tx.Commit()
        return err</span>
}

func NewDepositeRepository(db *sql.DB, user BiodataUser) DepositeRepository <span class="cov8" title="1">{
        return &amp;depositeRepository{
                db:   db,
                user: user,
        }
}</span>
</pre>
		
		<pre class="file" id="file14" style="display: none">package repository

import (
        "database/sql"
        "math"
        "polen/model"
        "polen/model/dto"
)

type LatePaymentFee interface {
        CreateNew(payload model.LatePaymentFee) error
        FindById(id string) (model.LatePaymentFee, error)
        Pagging(payload dto.PageRequest) ([]model.LatePaymentFee, dto.Paging, error)
        Update(payload model.LatePaymentFee) error
        DeleteById(id string) error
}
type latePaymentFeeRepository struct {
        db *sql.DB
}

// CreateNew implements LatePaymentFee.
func (a *latePaymentFeeRepository) CreateNew(payload model.LatePaymentFee) error <span class="cov8" title="1">{
        _, err := a.db.Exec("INSERT INTO late_payment_fee VALUES ($1, $2, $3, $4)", payload.Id, payload.Name, payload.Nominal, payload.Unit)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">return nil</span>
}

// DeleteById implements LatePaymentFee.
func (a *latePaymentFeeRepository) DeleteById(id string) error <span class="cov8" title="1">{
        _, err := a.db.Exec("DELETE FROM late_payment_fee WHERE id = $1", id)
        return err
}</span>

// FindById implements LatePaymentFee.
func (a *latePaymentFeeRepository) FindById(id string) (model.LatePaymentFee, error) <span class="cov8" title="1">{
        row := a.db.QueryRow(`SELECT 
                id, 
                name,
                nominal,
                unit
        FROM 
                late_payment_fee
        WHERE id =$1`, id)
        LatePaymentFee := model.LatePaymentFee{}
        err := row.Scan(
                &amp;LatePaymentFee.Id,
                &amp;LatePaymentFee.Name,
                &amp;LatePaymentFee.Nominal,
                &amp;LatePaymentFee.Unit,
        )
        if err != nil </span><span class="cov8" title="1">{
                return model.LatePaymentFee{}, err
        }</span>
        <span class="cov8" title="1">return LatePaymentFee, nil</span>
}

// Pagging implements LatePaymentFee.
func (a *latePaymentFeeRepository) Pagging(payload dto.PageRequest) ([]model.LatePaymentFee, dto.Paging, error) <span class="cov8" title="1">{
        if payload.Page &lt; 0 </span><span class="cov0" title="0">{
                payload.Page = 1
        }</span>
        <span class="cov8" title="1">query := `SELECT 
                id, 
                name,
                nominal,
                unit
        FROM 
                late_payment_fee
        LIMIT 
                $2 
        OFFSET 
                $1;
        `
        rows, err := a.db.Query(query, (payload.Page-1)*payload.Page, payload.Size)
        if err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()
        var data []model.LatePaymentFee
        for rows.Next() </span><span class="cov8" title="1">{
                var LatePaymentFee model.LatePaymentFee
                err := rows.Scan(
                        &amp;LatePaymentFee.Id,
                        &amp;LatePaymentFee.Name,
                        &amp;LatePaymentFee.Nominal,
                        &amp;LatePaymentFee.Unit,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, dto.Paging{}, err
                }</span>
                <span class="cov8" title="1">data = append(data, LatePaymentFee)</span>
        }

        <span class="cov8" title="1">var count int
        row := a.db.QueryRow("SELECT COUNT(id) FROM late_payment_fee")
        if err := row.Scan(&amp;count); err != nil </span><span class="cov0" title="0">{
                return nil, dto.Paging{}, err
        }</span>

        <span class="cov8" title="1">paging := dto.Paging{
                Page:       payload.Page,
                Size:       payload.Size,
                TotalRows:  count,
                TotalPages: int(math.Ceil(float64(count) / float64(payload.Size))),
        }

        return data, paging, nil</span>
}

// Update implements LatePaymentFee.
func (a *latePaymentFeeRepository) Update(payload model.LatePaymentFee) error <span class="cov8" title="1">{
        _, err := a.db.Exec(`
                UPDATE 
                        late_payment_fee
                SET 
                        name = $2, 
                        nominal = $3,
                        unit =$4
                WHERE 
                        id = $1;`,
                payload.Id,
                payload.Name,
                payload.Nominal,
                payload.Unit,
        )
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">return nil</span>
}

func NewLatePaymentFeeRepository(db *sql.DB) LatePaymentFee <span class="cov8" title="1">{
        return &amp;latePaymentFeeRepository{
                db: db,
        }
}</span>
</pre>
		
		<pre class="file" id="file15" style="display: none">package repository

import (
        "database/sql"
        "math"
        "polen/model"
        "polen/model/dto"
)

type LoanInterest interface {
        CreateNew(payload model.LoanInterest) error
        FindById(id string) (model.LoanInterest, error)
        Pagging(payload dto.PageRequest) ([]model.LoanInterest, dto.Paging, error)
        Update(payload model.LoanInterest) error
        DeleteById(id string) error
}
type loanInterestRepository struct {
        db *sql.DB
}

// Pagging implements LoanInterest.
func (l *loanInterestRepository) Pagging(payload dto.PageRequest) ([]model.LoanInterest, dto.Paging, error) <span class="cov8" title="1">{
        if payload.Page &lt; 0 </span><span class="cov0" title="0">{
                payload.Page = 1
        }</span>
        <span class="cov8" title="1">query := `SELECT 
                id, 
                duration_months,
                loan_interest_rate
        FROM 
                loan_interest
        LIMIT 
                $2 
        OFFSET 
                $1;
        `
        rows, err := l.db.Query(query, (payload.Page-1)*payload.Page, payload.Size)
        if err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()
        var data []model.LoanInterest
        for rows.Next() </span><span class="cov8" title="1">{
                var loan model.LoanInterest
                err := rows.Scan(
                        &amp;loan.Id,
                        &amp;loan.DurationMonths,
                        &amp;loan.LoanInterestRate,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, dto.Paging{}, err
                }</span>
                <span class="cov8" title="1">data = append(data, loan)</span>
        }

        <span class="cov8" title="1">var count int
        row := l.db.QueryRow("SELECT COUNT(id) FROM loan_interest")
        if err := row.Scan(&amp;count); err != nil </span><span class="cov0" title="0">{
                return nil, dto.Paging{}, err
        }</span>

        <span class="cov8" title="1">paging := dto.Paging{
                Page:       payload.Page,
                Size:       payload.Size,
                TotalRows:  count,
                TotalPages: int(math.Ceil(float64(count) / float64(payload.Size))),
        }

        return data, paging, nil</span>
}

// CreateNew implements LoanInterest.
func (l *loanInterestRepository) CreateNew(payload model.LoanInterest) error <span class="cov8" title="1">{
        _, err := l.db.Exec("INSERT INTO loan_interest VALUES ($1, $2, $3)", payload.Id, payload.DurationMonths, payload.LoanInterestRate)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">return nil</span>
}

// DeleteById implements LoanInterest.
func (l *loanInterestRepository) DeleteById(id string) error <span class="cov8" title="1">{
        _, err := l.db.Exec("DELETE FROM loan_interest WHERE id = $1", id)
        return err
}</span>

// FindById implements LoanInterest.
func (l *loanInterestRepository) FindById(id string) (model.LoanInterest, error) <span class="cov8" title="1">{
        row := l.db.QueryRow(`SELECT 
                id, 
                duration_months,
                loan_interest_rate
        FROM 
                loan_interest 
        WHERE id =$1`, id)
        LoanInterest := model.LoanInterest{}
        err := row.Scan(
                &amp;LoanInterest.Id,
                &amp;LoanInterest.DurationMonths,
                &amp;LoanInterest.LoanInterestRate,
        )
        if err != nil </span><span class="cov8" title="1">{
                return model.LoanInterest{}, err
        }</span>
        <span class="cov8" title="1">return LoanInterest, nil</span>
}

// Update implements LoanInterest.
func (l *loanInterestRepository) Update(payload model.LoanInterest) error <span class="cov8" title="1">{
        _, err := l.db.Exec(`
                UPDATE 
                        loan_interest 
                SET 
                        duration_months = $2, 
                        loan_interest_rate = $3
                WHERE 
                        id = $1;`,
                payload.Id,
                payload.DurationMonths,
                payload.LoanInterestRate,
        )
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">return nil</span>
}

func NewLoanInterestRepository(db *sql.DB) LoanInterest <span class="cov8" title="1">{
        return &amp;loanInterestRepository{
                db: db,
        }
}</span>
</pre>
		
		<pre class="file" id="file16" style="display: none">package repository

import (
        "database/sql"
        "fmt"
        "polen/model"
        "polen/model/dto"
        "strconv"
        "time"
)

type LoanRepository interface {
        Create(loanReq model.Loan, installenment []model.InstallenmentLoan) error
        FindById(id string) (dto.InstallenmentLoanByIdResponse, error)
        FindByLoanId(id string) (dto.Loan, error)
        Upload(payload dto.LoanInstallenmentResponse) error
        FindUploadedFile() ([]dto.LoanInstallenmentResponse, error)
        Accepted(payload dto.InstallenmentLoanByIdResponse) error
        UpdateLateFee() error
}

type loanRepository struct {
        db   *sql.DB
        user BiodataUser
}

// FindByLoanId implements LoanRepository.
func (l *loanRepository) FindByLoanId(id string) (dto.Loan, error) <span class="cov0" title="0">{
        rows, err := l.db.Query(`
        SELECT 
                id,
                is_payed,
                payment_installenment_cost,
                payment_deadline,
                total_amount_of_dept,
                late_payment_fee_nominal,
                late_payment_fee_unit,
                late_payment_fee_total,
                late_payment_fee_day,
                payment_date,
                status,
                transfer_confirmation_recipt,
                recipt_file
        FROM
                installenment_loan
        WHERE 
                loan_id = $1;
                `, id)
        if err != nil </span><span class="cov0" title="0">{
                return dto.Loan{}, err
        }</span>
        <span class="cov0" title="0">defer rows.Close()
        var data []dto.LoanInstallenmentResponse
        for rows.Next() </span><span class="cov0" title="0">{
                var datum dto.LoanInstallenmentResponse
                var nominal float64
                var unit string
                rows.Scan(
                        &amp;datum.Id,
                        &amp;datum.IsPayed,
                        &amp;datum.PaymentInstallment,
                        &amp;datum.PaymentDeadLine,
                        &amp;datum.TotalAmountOfDepth,
                        &amp;nominal,
                        &amp;unit,
                        &amp;datum.LatePayment.LatePaymentFeesTotal,
                        &amp;datum.LatePayment.LatePaymentDays,
                        &amp;datum.PaymentDate,
                        &amp;datum.Status,
                        &amp;datum.TransferConfirmRecipe,
                        &amp;datum.File,
                )
                datum.LatePayment.LatePaymentFees = strconv.Itoa(int(nominal)) + " " + unit
                data = append(data, datum)
        }</span>
        <span class="cov0" title="0">row := l.db.QueryRow(`
        SELECT 
                id,
                user_credential_id,
                loan_amount,
                loan_interest_rate,
                loan_interest_nominal,
                total_amount_of_dept,
                application_handling_cost_nominal,
                application_handling_cost_unit,
                loan_date_created
        FROM
                loan
        WHERE 
                id = $1;
                `, id)
        var loan dto.Loan
        var ahcn float64
        var ahcu string
        err = row.Scan(
                &amp;loan.Id,
                &amp;loan.UserCredentialId,
                &amp;loan.LoanAmount,
                &amp;loan.LoanInterestRate,
                &amp;loan.LoanInterestNominal,
                &amp;loan.TotalAmountOfDepth,
                &amp;ahcn,
                &amp;ahcu,
                &amp;loan.LoanDateCreate,
        )
        loan.AppHandlingCost = strconv.Itoa(int(ahcn)) + " " + ahcu
        loan.Installment = data
        if err != nil </span><span class="cov0" title="0">{
                return dto.Loan{}, err
        }</span>
        <span class="cov0" title="0">return loan, nil</span>
}

// UpdateLateFee implements LoanRepository.
func (l *loanRepository) UpdateLateFee() error <span class="cov8" title="1">{
        rows, err := l.db.Query(`
        SELECT 
                id,
                total_amount_of_dept,
                payment_deadline,
                late_payment_fee_nominal,
                late_payment_fee_unit
        FROM
                installenment_loan
        WHERE 
                is_payed = false
        AND
                transfer_confirmation_recipt = true
                AND
                        payment_deadline &lt; now();
                `)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">defer rows.Close()
        var data []dto.LoanInstallenmentResponse
        for rows.Next() </span><span class="cov8" title="1">{
                var datum dto.LoanInstallenmentResponse
                var nominal float64
                var unit string
                err := rows.Scan(
                        &amp;datum.Id,
                        &amp;datum.TotalAmountOfDepth,
                        &amp;datum.PaymentDeadLine,
                        &amp;nominal,
                        &amp;unit,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return err
                }</span>
                // Hitung selisih antara tanggal saat ini dan tanggal target
                <span class="cov8" title="1">selisih := time.Since(datum.PaymentDeadLine)
                // Konversi selisih ke dalam hari
                hariTerlewat := int(selisih.Hours() / 24)
                datum.LatePayment.LatePaymentDays = hariTerlewat
                if unit == "rupiah" </span><span class="cov0" title="0">{
                        datum.LatePayment.LatePaymentFeesTotal = int(nominal * float64(hariTerlewat))
                }</span> else<span class="cov8" title="1"> if unit == "percent" </span><span class="cov0" title="0">{
                        datum.LatePayment.LatePaymentFeesTotal = int((nominal * float64(datum.TotalAmountOfDepth)) * float64(hariTerlewat))
                }</span>
                <span class="cov8" title="1">data = append(data, datum)
                fmt.Println(datum)</span>
        }
        <span class="cov8" title="1">fmt.Println(data)
        tx, err := l.db.Begin()
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">for _, v := range data </span><span class="cov8" title="1">{
                tx.Exec(`
                UPDATE 
                        installenment_loan 
                SET 
                        late_payment_fee_day = $2, 
                        late_payment_fee_total = $3, 
                        total_amount_of_dept = total_amount_of_dept + $4
                WHERE 
                        id = $1
                `,
                        v.Id,
                        v.LatePayment.LatePaymentDays,
                        v.LatePayment.LatePaymentFeesTotal,
                        v.LatePayment.LatePaymentFeesTotal,
                )
                fmt.Println(v)
        }</span>
        <span class="cov8" title="1">tx.Commit()
        return nil</span>
}

// Accepted implements LoanRepository.
func (t *loanRepository) Accepted(payload dto.InstallenmentLoanByIdResponse) error <span class="cov8" title="1">{
        tx, err := t.db.Begin()
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">_, err = tx.Exec(`
                UPDATE 
                        installenment_loan 
                SET 
                        is_payed = $2, 
                        status = $3
                WHERE 
                        id = $1;`,
                payload.LoanInst.Id,
                payload.LoanInst.IsPayed,
                payload.LoanInst.Status,
        )
        if err != nil </span><span class="cov8" title="1">{
                tx.Rollback()
                return err
        }</span>
        <span class="cov8" title="1">if !payload.LoanInst.IsPayed </span><span class="cov8" title="1">{
                _, err = tx.Exec(
                        `
                        UPDATE saldo
                        SET total_saving = total_saving + $1
                        WHERE user_credential_id = '456';
                        `,
                        payload.LoanInst.TotalAmountOfDepth,
                )
                if err != nil </span><span class="cov8" title="1">{
                        tx.Rollback()
                        return err
                }</span>
        }
        <span class="cov8" title="1">tx.Commit()
        return err</span>
}

// Upload implements LoanRepository.
func (t *loanRepository) Upload(payload dto.LoanInstallenmentResponse) error <span class="cov8" title="1">{
        _, err := t.db.Exec(`
                UPDATE 
                        installenment_loan 
                SET 
                        payment_date = $2, 
                        status = 'witing for accepment',
                        transfer_confirmation_recipt = true,
                        recipt_file = $3
                WHERE 
                        id = $1;`,
                payload.Id,
                time.Now(),
                payload.File,
        )
        return err
}</span>

// FindById implements LoanRepository.
func (l *loanRepository) FindById(id string) (dto.InstallenmentLoanByIdResponse, error) <span class="cov0" title="0">{
        row := l.db.QueryRow(`
        SELECT 
                installenment_loan.id, 
                user_credential_id,
                loan_id,
                installenment_loan.is_payed,
                payment_installenment_cost,
                payment_deadline,
                installenment_loan.total_amount_of_dept,
                late_payment_fee_nominal,
                late_payment_fee_unit,
                late_payment_fee_day,
                payment_date,
                installenment_loan.status,
                transfer_confirmation_recipt,
                recipt_file
        FROM 
                installenment_loan 
        JOIN
                loan on loan.id = installenment_loan.loan_id
        WHERE 
                installenment_loan.id = $1`, id)

        var loanInstallenment dto.LoanInstallenmentResponse
        var loanId string
        var ucid string
        var latePaymentFeesNominal float64
        var latepaymentfeeUnit string
        row.Scan(
                &amp;loanInstallenment.Id,
                &amp;ucid,
                &amp;loanId,
                &amp;loanInstallenment.IsPayed,
                &amp;loanInstallenment.PaymentInstallment,
                &amp;loanInstallenment.PaymentDeadLine,
                &amp;loanInstallenment.TotalAmountOfDepth,
                &amp;latePaymentFeesNominal,
                &amp;latepaymentfeeUnit,
                &amp;loanInstallenment.LatePayment.LatePaymentDays,
                &amp;loanInstallenment.PaymentDate,
                &amp;loanInstallenment.Status,
                &amp;loanInstallenment.TransferConfirmRecipe,
                &amp;loanInstallenment.File,
        )
        loanInstallenment.LatePayment.LatePaymentFees = strconv.Itoa(int(latePaymentFeesNominal)) + " " + latepaymentfeeUnit
        fmt.Println(loanInstallenment)
        fmt.Println(ucid)
        // get biodata user
        bio, err := l.user.FindByUcId(ucid)
        fmt.Println(bio)
        if err != nil </span><span class="cov0" title="0">{
                return dto.InstallenmentLoanByIdResponse{}, err
        }</span>

        <span class="cov0" title="0">return dto.InstallenmentLoanByIdResponse{
                UserDeatail: bio,
                LoanId:      loanId,
                LoanInst:    loanInstallenment,
        }, nil</span>
}

// FindById implements LoanRepository.
func (l *loanRepository) FindUploadedFile() ([]dto.LoanInstallenmentResponse, error) <span class="cov8" title="1">{
        rows, err := l.db.Query(`
        SELECT 
                id,
                loan_id,
                is_payed,
                payment_installenment_cost,
                payment_deadline,
                total_amount_of_dept,
                late_payment_fee_nominal,
                late_payment_fee_unit,
                late_payment_fee_day,
                payment_date,
                status,
                transfer_confirmation_recipt,
                recipt_file
        FROM
                installenment_loan
        WHERE 
                is_payed = false
        AND
                transfer_confirmation_recipt = true;
                `)
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()
        var datum []dto.LoanInstallenmentResponse
        for rows.Next() </span><span class="cov8" title="1">{
                var loanInstallenment dto.LoanInstallenmentResponse
                var loanId string
                var latePaymentFeesNominal float64
                var latepaymentfeeUnit string
                err := rows.Scan(
                        &amp;loanInstallenment.Id,
                        &amp;loanId,
                        &amp;loanInstallenment.IsPayed,
                        &amp;loanInstallenment.PaymentInstallment,
                        &amp;loanInstallenment.PaymentDeadLine,
                        &amp;loanInstallenment.TotalAmountOfDepth,
                        &amp;latePaymentFeesNominal,
                        &amp;latepaymentfeeUnit,
                        &amp;loanInstallenment.LatePayment.LatePaymentDays,
                        &amp;loanInstallenment.PaymentDate,
                        &amp;loanInstallenment.Status,
                        &amp;loanInstallenment.TransferConfirmRecipe,
                        &amp;loanInstallenment.File,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">loanInstallenment.LatePayment.LatePaymentFees = strconv.Itoa(int(latePaymentFeesNominal)) + " " + latepaymentfeeUnit
                datum = append(datum, loanInstallenment)</span>
        }

        <span class="cov8" title="1">return datum, nil</span>
}

// create implements LoanRepository.
func (l *loanRepository) Create(loan model.Loan, installenment []model.InstallenmentLoan) error <span class="cov8" title="1">{
        tx, err := l.db.Begin()
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        // save loan
        <span class="cov8" title="1">_, err = tx.Exec(`
        INSERT INTO
                loan
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12);
        `,
                loan.Id,
                loan.UserCredentialId,
                loan.LoanAmount,
                loan.LoanDuration,
                loan.LoanInterestRate,
                loan.LoanInterestNominal,
                loan.TotalAmountOfDepth,
                loan.AppHandlingCostNominal,
                loan.AppHandlingCostUnit,
                loan.LoanDateCreate,
                loan.IsPayed,
                loan.Status,
        )
        if err != nil </span><span class="cov8" title="1">{
                tx.Rollback()
                return err
        }</span>
        // kurangi sado perusahaan
        <span class="cov8" title="1">_, err = tx.Exec(
                `
                UPDATE saldo
                SET total_saving = total_saving - $1
                WHERE user_credential_id = $2;
                `,
                loan.LoanAmount,
                "456",
        )
        if err != nil </span><span class="cov8" title="1">{
                tx.Rollback()
                return err
        }</span>
        // save installentment
        <span class="cov8" title="1">for _, v := range installenment </span><span class="cov8" title="1">{
                _, err = tx.Exec(`
                INSERT INTO
                        installenment_loan
                VALUES
                        ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14);
                `,
                        v.Id,
                        v.LoanId,
                        v.IsPayed,
                        v.PaymentInstallment,
                        v.PaymentDeadLine,
                        v.TotalAmountOfDepth,
                        v.LatePaymentFeesNominal,
                        v.LatePaymentFeesUnit,
                        v.LatePaymentDays,
                        v.LatePaymentFeesTotal,
                        v.PaymentDate,
                        v.Status,
                        v.TransferConfirmRecipe,
                        v.File,
                )
                if err != nil </span><span class="cov8" title="1">{
                        tx.Rollback()
                        return err
                }</span>
        }
        <span class="cov8" title="1">tx.Commit()
        return nil</span>
}

func NewLoanRepository(db *sql.DB, user BiodataUser) LoanRepository <span class="cov8" title="1">{
        return &amp;loanRepository{
                db:   db,
                user: user,
        }
}</span>
</pre>
		
		<pre class="file" id="file17" style="display: none">package repository

import (
        "database/sql"
        "math"
        "polen/model/dto"
)

type SaldoRepository interface {
        FindByIdUser(id string) (dto.Saldo, error)
        Pagging(payload dto.PageRequest) ([]dto.Saldo, dto.Paging, error)
}

type saldoRepository struct {
        db *sql.DB
}

// FindByIdUser implements SaldoRepository.
func (s *saldoRepository) FindByIdUser(id string) (dto.Saldo, error) <span class="cov8" title="1">{
        row := s.db.QueryRow(`
                SELECT 
                        id, 
                        total_saving
                FROM 
                        saldo 
                WHERE 
                        user_credential_id = $1`, id)
        var data dto.Saldo
        data.UcId = id
        err := row.Scan(
                &amp;data.Id,
                &amp;data.Total,
        )
        if err != nil </span><span class="cov8" title="1">{
                return dto.Saldo{}, err
        }</span>
        <span class="cov8" title="1">return data, nil</span>
}

// Pagging implements SaldoRepository.
func (s *saldoRepository) Pagging(payload dto.PageRequest) ([]dto.Saldo, dto.Paging, error) <span class="cov8" title="1">{
        // limit Size, Offset (page - 1) * size
        if payload.Page &lt; 0 </span><span class="cov0" title="0">{
                payload.Page = 1
        }</span>
        <span class="cov8" title="1">query := `
        SELECT 
                id, 
                total_saving
        FROM 
                saldo 
        LIMIT 
                $2 
        OFFSET 
                $1;
        `
        rows, err := s.db.Query(query, (payload.Page-1)*payload.Page, payload.Size)
        if err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()
        var data []dto.Saldo
        for rows.Next() </span><span class="cov8" title="1">{
                var datum dto.Saldo
                err := rows.Scan(
                        &amp;datum.Id,
                        &amp;datum.Total,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, dto.Paging{}, err
                }</span>
                <span class="cov8" title="1">data = append(data, datum)</span>
        }

        <span class="cov8" title="1">var count int
        row := s.db.QueryRow("SELECT COUNT(id) FROM saldo")
        if err := row.Scan(&amp;count); err != nil </span><span class="cov0" title="0">{
                return nil, dto.Paging{}, err
        }</span>

        <span class="cov8" title="1">paging := dto.Paging{
                Page:       payload.Page,
                Size:       payload.Size,
                TotalRows:  count,
                TotalPages: int(math.Ceil(float64(count) / float64(payload.Size))),
        }

        return data, paging, nil</span>
}

func NewSaldoRepository(db *sql.DB) SaldoRepository <span class="cov8" title="1">{
        return &amp;saldoRepository{
                db: db,
        }
}</span>
</pre>
		
		<pre class="file" id="file18" style="display: none">package repository

import (
        "database/sql"
        "math"
        "polen/model"
        "polen/model/dto"
)

type TopUp interface {
        Save(payload model.TopUp) error
        FindByIdUser(id string) (dto.TopUpByUser, error)
        FindById(id string) (dto.TopUpById, error)
        Upload(payload model.TopUp) error
        ConfimUpload(payload model.TopUp) error
        NotConfimUpload(payload model.TopUp) error
        FindUploadedFile() ([]dto.TopUp, error)
        Pagging(payload dto.PageRequest) ([]dto.TopUp, dto.Paging, error)
}

type topUpRepository struct {
        db *sql.DB
}

// Pagging implements TopUp.
func (t *topUpRepository) Pagging(payload dto.PageRequest) ([]dto.TopUp, dto.Paging, error) <span class="cov8" title="1">{
        query := `
        SELECT 
                id,
                maturity_time, 
                top_up_amount,
                accepted_time,
                accepted_status,
                status_information,
                transfer_confirmation_recipt,
                recipt_file
        FROM 
                top_up
        LIMIT 
                $2 
        OFFSET 
                $1;
        `
        rows, err := t.db.Query(query, (payload.Page-1)*payload.Page, payload.Size)
        if err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()
        var topUps []dto.TopUp
        for rows.Next() </span><span class="cov8" title="1">{
                var topUp dto.TopUp
                err := rows.Scan(
                        &amp;topUp.Id,
                        &amp;topUp.MaturityTime,
                        &amp;topUp.TopUpAmount,
                        &amp;topUp.AcceptedTime,
                        &amp;topUp.Accepted,
                        &amp;topUp.Status,
                        &amp;topUp.TransferConfirmRecipe,
                        &amp;topUp.File,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, dto.Paging{}, err
                }</span>
                <span class="cov8" title="1">topUps = append(topUps, topUp)</span>
        }

        <span class="cov8" title="1">var count int
        row := t.db.QueryRow("SELECT COUNT(id) FROM top_up")
        if err := row.Scan(&amp;count); err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>

        <span class="cov8" title="1">paging := dto.Paging{
                Page:       payload.Page,
                Size:       payload.Size,
                TotalRows:  count,
                TotalPages: int(math.Ceil(float64(count) / float64(payload.Size))),
        }

        return topUps, paging, nil</span>
}

// FindUploadedFile implements TopUp.
func (t *topUpRepository) FindUploadedFile() ([]dto.TopUp, error) <span class="cov8" title="1">{
        topUpResult, err := t.db.Query(`
                SELECT 
                        id,
                        maturity_time, 
                        top_up_amount,
                        accepted_time,
                        accepted_status,
                        status_information,
                        transfer_confirmation_recipt,
                        recipt_file
                FROM 
                        top_up
                WHERE 
                        transfer_confirmation_recipt = true
                        AND
                        accepted_status = false;`,
        )
        if err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">defer topUpResult.Close()
        var topUps []dto.TopUp
        for topUpResult.Next() </span><span class="cov8" title="1">{
                var topUp dto.TopUp
                err = topUpResult.Scan(
                        &amp;topUp.Id,
                        &amp;topUp.MaturityTime,
                        &amp;topUp.TopUpAmount,
                        &amp;topUp.AcceptedTime,
                        &amp;topUp.Accepted,
                        &amp;topUp.Status,
                        &amp;topUp.TransferConfirmRecipe,
                        &amp;topUp.File,
                )
                if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>
                <span class="cov8" title="1">topUps = append(topUps, topUp)</span>
        }
        <span class="cov8" title="1">return topUps, nil</span>
}

// ConfimUpload implements TopUp.
func (t *topUpRepository) ConfimUpload(payload model.TopUp) error <span class="cov8" title="1">{
        tx, err := t.db.Begin()
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">_, err = tx.Exec(`
                UPDATE 
                        top_up 
                SET 
                        accepted_status = $2,
                        accepted_time = $3,
                        status_information = $4, 
                        transfer_confirmation_recipt = $5,
                        recipt_file = $6,
                        maturity_time = $7
                WHERE 
                        id = $1;`,
                payload.Id,
                payload.Accepted,
                payload.AcceptedTime,
                payload.Status,
                payload.TransferConfirmRecipe,
                payload.File,
                payload.MaturityTime,
        )
        if err != nil </span><span class="cov8" title="1">{
                tx.Rollback()
                return err
        }</span>
        <span class="cov8" title="1">_, err = tx.Exec(
                `
                UPDATE saldo
                SET total_saving = total_saving + $1
                WHERE user_credential_id = $2;
                `,
                payload.TopUpAmount,
                payload.UserCredential.Id,
        )
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>
        <span class="cov8" title="1">tx.Commit()
        return err</span>
}

func (t *topUpRepository) NotConfimUpload(payload model.TopUp) error <span class="cov8" title="1">{
        _, err := t.db.Exec(`
                UPDATE 
                        top_up 
                SET 
                        accepted_status = $2,
                        status_information = $3, 
                        transfer_confirmation_recipt = $4,
                        recipt_file = $5,
                        maturity_time = $6
                WHERE 
                        id = $1;`,
                payload.Id,
                payload.Accepted,
                payload.Status,
                payload.TransferConfirmRecipe,
                payload.File,
                payload.MaturityTime,
        )
        return err
}</span>

// Upload implements TopUp.
func (t *topUpRepository) Upload(payload model.TopUp) error <span class="cov8" title="1">{
        _, err := t.db.Exec(`
                UPDATE 
                        top_up 
                SET 
                        status_information = $2, 
                        transfer_confirmation_recipt = $3,
                        recipt_file = $4
                WHERE 
                        id = $1;`,
                payload.Id,
                payload.Status,
                payload.TransferConfirmRecipe,
                payload.File,
        )
        return err
}</span>

// FindById implements TopUp.
func (t *topUpRepository) FindById(id string) (dto.TopUpById, error) <span class="cov8" title="1">{
        rows := t.db.QueryRow(`
    SELECT 
        u.id, 
        u.username, 
        u.email, 
        u.role, 
        u.is_active, 
        u.virtual_account_number,
        b.full_name, 
        b.nik, 
        b.phone_number, 
        b.occupation, 
        b.place_of_birth, 
        b.date_of_birth, 
        b.postal_code,
        t.id, 
        t.top_up_amount, 
        t.maturity_time, 
        t.accepted_time,
        t.accepted_status,
        t.status_information,
        t.transfer_confirmation_recipt,
                                t.recipt_file
    FROM 
        top_up t
    JOIN 
        biodata b ON b.user_credential_id = t.user_credential_id
    JOIN
        user_credential u ON u.id = b.user_credential_id
    WHERE 
        t.id = $1`,
                id,
        )

        var result dto.TopUpById
        result.UserCredential.Password = "********"
        err := rows.Scan(
                &amp;result.UserCredential.Id,
                &amp;result.UserCredential.Username,
                &amp;result.UserCredential.Email,
                &amp;result.UserCredential.Role,
                &amp;result.UserCredential.IsActive,
                &amp;result.UserCredential.VaNumber,
                &amp;result.UserBio.NamaLengkap,
                &amp;result.UserBio.Nik,
                &amp;result.UserBio.NomorTelepon,
                &amp;result.UserBio.Pekerjaan,
                &amp;result.UserBio.TempatLahir,
                &amp;result.UserBio.TanggalLahir,
                &amp;result.UserBio.KodePos,
                &amp;result.TopUp.Id,
                &amp;result.TopUp.TopUpAmount,
                &amp;result.TopUp.MaturityTime,
                &amp;result.TopUp.AcceptedTime,
                &amp;result.TopUp.Accepted,
                &amp;result.TopUp.Status,
                &amp;result.TopUp.TransferConfirmRecipe,
                &amp;result.TopUp.File,
        )
        result.TopUp.VaNumber = result.UserCredential.VaNumber
        if err != nil </span><span class="cov8" title="1">{
                return dto.TopUpById{}, err
        }</span>
        <span class="cov8" title="1">return result, nil</span>
}

// FindById implements TopUp.
func (t *topUpRepository) FindByIdUser(id string) (dto.TopUpByUser, error) <span class="cov8" title="1">{
        userResult := t.db.QueryRow(`
        SELECT 
                        u.id, 
                        u.username, 
                        u.email, 
                        u.role, 
                        u.is_active, 
                        u.virtual_account_number,
                b.full_name, 
                b.nik, 
                b.phone_number, 
                b.occupation, 
                b.place_of_birth, 
                b.date_of_birth, 
                b.postal_code
        FROM 
                biodata b 
        JOIN 
                user_credential u 
        ON 
                u.id = b.user_credential_id
        WHERE
        b.user_credential_id = $1;
        `, id)
        var result dto.TopUpByUser
        result.UserCredential.Password = "********"
        err := userResult.Scan(
                &amp;result.UserCredential.Id,
                &amp;result.UserCredential.Username,
                &amp;result.UserCredential.Email,
                &amp;result.UserCredential.Role,
                &amp;result.UserCredential.IsActive,
                &amp;result.UserCredential.VaNumber,
                &amp;result.UserBio.NamaLengkap,
                &amp;result.UserBio.Nik,
                &amp;result.UserBio.NomorTelepon,
                &amp;result.UserBio.Pekerjaan,
                &amp;result.UserBio.TempatLahir,
                &amp;result.UserBio.TanggalLahir,
                &amp;result.UserBio.KodePos,
        )
        if err != nil </span><span class="cov8" title="1">{
                return dto.TopUpByUser{}, err
        }</span>
        <span class="cov8" title="1">topUpResult, err := t.db.Query(`
                SELECT 
                        id,
                        maturity_time, 
                        top_up_amount,
                        accepted_time,
                        accepted_status,
                        status_information,
                        transfer_confirmation_recipt,
                        recipt_file
                FROM 
                        top_up
                WHERE 
                        user_credential_id = $1`,
                id,
        )
        if err != nil </span><span class="cov8" title="1">{
                return dto.TopUpByUser{}, err
        }</span>
        <span class="cov8" title="1">defer topUpResult.Close()
        var topUps []dto.TopUp
        for topUpResult.Next() </span><span class="cov8" title="1">{
                var topUp dto.TopUp
                err = topUpResult.Scan(
                        &amp;topUp.Id,
                        &amp;topUp.MaturityTime,
                        &amp;topUp.TopUpAmount,
                        &amp;topUp.AcceptedTime,
                        &amp;topUp.Accepted,
                        &amp;topUp.Status,
                        &amp;topUp.TransferConfirmRecipe,
                        &amp;topUp.File,
                )
                topUp.VaNumber = result.UserCredential.VaNumber
                if err != nil </span><span class="cov0" title="0">{
                        return dto.TopUpByUser{}, err
                }</span>
                <span class="cov8" title="1">topUps = append(topUps, topUp)</span>
        }
        <span class="cov8" title="1">result.TopUp = topUps
        return result, err</span>
}

// Save implements TopUp.
func (t *topUpRepository) Save(payload model.TopUp) error <span class="cov8" title="1">{
        _, err := t.db.Exec("INSERT INTO top_up VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)",
                payload.Id,
                payload.UserCredential.Id,
                payload.TopUpAmount,
                payload.MaturityTime,
                payload.AcceptedTime,
                payload.Accepted,
                payload.Status,
                payload.TransferConfirmRecipe,
                payload.File,
        )
        return err
}</span>

func NewTopUpRepository(db *sql.DB) TopUp <span class="cov8" title="1">{
        return &amp;topUpRepository{
                db: db,
        }
}</span>
</pre>
		
		<pre class="file" id="file19" style="display: none">package repository

import (
        "database/sql"
        "math"
        "polen/model"
        "polen/model/dto"
        "time"
)

type UserRepository interface {
        Save(payload model.UserCredential, bioId string) error
        Saldo(payload model.UserCredential, idsaldo string, bioId string) error
        FindByUsername(username string) (model.UserCredential, error)
        Pagging(payload dto.PageRequest) ([]model.UserCredential, dto.Paging, error)
        FindById(id string) (model.UserCredential, error)
}

type userRepository struct {
        db *sql.DB
}

// pagging implements UserRepository.
func (u *userRepository) Pagging(payload dto.PageRequest) ([]model.UserCredential, dto.Paging, error) <span class="cov8" title="1">{
        query := `SELECT id, username, email, role, virtual_account_number, is_active FROM user_credential LIMIT $2 OFFSET $1`
        rows, err := u.db.Query(query, (payload.Page-1)*payload.Page, payload.Size)
        if err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>
        <span class="cov8" title="1">defer rows.Close()
        var data []model.UserCredential
        for rows.Next() </span><span class="cov8" title="1">{
                var datum model.UserCredential
                err := rows.Scan(
                        &amp;datum.Id,
                        &amp;datum.Username,
                        &amp;datum.Email,
                        &amp;datum.Role,
                        &amp;datum.VANumber,
                        &amp;datum.IsActive,
                )
                datum.Password = "********"
                if err != nil </span><span class="cov0" title="0">{
                        return nil, dto.Paging{}, err
                }</span>
                <span class="cov8" title="1">data = append(data, datum)</span>
        }

        <span class="cov8" title="1">var count int
        row := u.db.QueryRow("SELECT COUNT(id) FROM user_credential")
        if err := row.Scan(&amp;count); err != nil </span><span class="cov8" title="1">{
                return nil, dto.Paging{}, err
        }</span>

        <span class="cov8" title="1">paging := dto.Paging{
                Page:       payload.Page,
                Size:       payload.Size,
                TotalRows:  count,
                TotalPages: int(math.Ceil(float64(count) / float64(payload.Size))),
        }

        return data, paging, nil</span>
}

// saldo implements UserRepository.
func (u *userRepository) Saldo(payload model.UserCredential, idsaldo string, bioId string) error <span class="cov8" title="1">{
        tx, err := u.db.Begin()
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">_, err = tx.Exec("INSERT INTO user_credential VALUES ($1, $2, $3, $4, $5, $6, $7)", payload.Id, payload.Username, payload.Email, payload.Password, payload.Role, payload.VANumber, true)
        if err != nil </span><span class="cov8" title="1">{
                tx.Rollback()
                return err
        }</span>
        <span class="cov8" title="1">_, err = tx.Exec("INSERT INTO biodata VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12)",
                bioId,
                payload.Id,
                "",
                "",
                "",
                "",
                "",
                time.DateOnly,
                "",
                false,
                false,
                "biodata is not updated",
        )
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">_, err = tx.Exec("INSERT INTO saldo VALUES ($1, $2, $3)", idsaldo, payload.Id, 0)
        if err != nil </span><span class="cov8" title="1">{
                tx.Rollback()
                return err
        }</span>
        <span class="cov8" title="1">tx.Commit()
        return err</span>
}

// FindById implements UserRepository.
func (u *userRepository) FindById(id string) (model.UserCredential, error) <span class="cov8" title="1">{
        row := u.db.QueryRow(`
                SELECT 
                        id, 
                        username, 
                        email,
                        role, 
                        virtual_account_number,
                        is_active
                FROM 
                        user_credential 
                WHERE 
                        id =$1`, id)
        var userCredential model.UserCredential
        userCredential.Password = "**********"
        err := row.Scan(
                &amp;userCredential.Id,
                &amp;userCredential.Username,
                &amp;userCredential.Email,
                &amp;userCredential.Role,
                &amp;userCredential.VANumber,
                &amp;userCredential.IsActive,
        )
        if err != nil </span><span class="cov8" title="1">{
                return model.UserCredential{}, err
        }</span>
        <span class="cov8" title="1">return userCredential, nil</span>
}

// FindByUsername implements UserRepository.
func (u *userRepository) FindByUsername(username string) (model.UserCredential, error) <span class="cov8" title="1">{
        row := u.db.QueryRow("SELECT id, username, role, password FROM user_credential WHERE username = $1", username)
        var userCredential model.UserCredential
        err := row.Scan(&amp;userCredential.Id, &amp;userCredential.Username, &amp;userCredential.Role, &amp;userCredential.Password)
        if err != nil </span><span class="cov8" title="1">{
                return model.UserCredential{}, err
        }</span>
        <span class="cov8" title="1">return userCredential, nil</span>
}

// Save implements UserRepository.
func (u *userRepository) Save(payload model.UserCredential, bioId string) error <span class="cov8" title="1">{
        tx, err := u.db.Begin()
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">_, err = tx.Exec("INSERT INTO user_credential VALUES ($1, $2, $3, $4, $5, $6, $7)", payload.Id, payload.Username, payload.Email, payload.Password, payload.Role, payload.VANumber, true)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">_, err = tx.Exec("INSERT INTO biodata VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12)",
                bioId,
                payload.Id,
                "",
                "",
                "",
                "",
                "",
                time.DateOnly,
                "",
                false,
                false,
                "biodata is not updated",
        )
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>
        <span class="cov8" title="1">tx.Commit()
        return nil</span>
}

func NewUserRepository(db *sql.DB) UserRepository <span class="cov8" title="1">{
        return &amp;userRepository{
                db: db,
        }
}</span>
</pre>
		
		<pre class="file" id="file20" style="display: none">package usecase

import (
        "fmt"
        "polen/model"
        "polen/model/dto"
        "polen/repository"
)

type AppHandlingCostUsecase interface {
        CreateNew(payload model.AppHandlingCost) (int, error)
        Pagging(payload dto.PageRequest) ([]model.AppHandlingCost, dto.Paging, error)
        FindById(id string) (model.AppHandlingCost, error)
        Update(payload model.AppHandlingCost) error
        DeleteById(id string) error
}

type appHandlingCostUseCase struct {
        repo repository.AppHandlingCost
}

// CreateNew implements AppHandlingCostUsecase.
func (a *appHandlingCostUseCase) CreateNew(payload model.AppHandlingCost) (int, error) <span class="cov8" title="1">{
        if payload.Id == "" </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("id is required")
        }</span>
        <span class="cov8" title="1">if payload.Name == "" </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("name is required")
        }</span>
        <span class="cov8" title="1">if payload.Nominal == 0 </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("nominal is required")
        }</span>

        <span class="cov8" title="1">if payload.Unit == "" </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("unit is required")
        }</span>

        <span class="cov8" title="1">if payload.Unit != "rupiah" &amp;&amp; payload.Unit != "percent" </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("unit must be rupiah or percent")
        }</span>

        <span class="cov8" title="1">if err := a.repo.CreateNew(payload); err != nil </span><span class="cov8" title="1">{
                return 500, err
        }</span>
        <span class="cov8" title="1">return 201, nil</span>
}

// DeleteById implements AppHandlingCostUsecase.
func (a *appHandlingCostUseCase) DeleteById(id string) error <span class="cov8" title="1">{
        app, err := a.repo.FindById(id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">err = a.repo.DeleteById(app.Id)
        if err != nil </span><span class="cov8" title="1">{
                return fmt.Errorf("failed to delete app handling cost: %v", err)
        }</span>

        <span class="cov8" title="1">return nil</span>
}

// FindById implements AppHandlingCostUsecase.
func (a *appHandlingCostUseCase) FindById(id string) (model.AppHandlingCost, error) <span class="cov8" title="1">{
        return a.repo.FindById(id)
}</span>

// Pagging implements AppHandlingCostUsecase.
func (a *appHandlingCostUseCase) Pagging(payload dto.PageRequest) ([]model.AppHandlingCost, dto.Paging, error) <span class="cov8" title="1">{
        return a.repo.Pagging(payload)
}</span>

// Update implements AppHandlingCostUsecase.
func (a *appHandlingCostUseCase) Update(payload model.AppHandlingCost) error <span class="cov8" title="1">{
        if payload.Id == "" </span><span class="cov8" title="1">{
                return fmt.Errorf("id is required")
        }</span>

        <span class="cov8" title="1">result, err := a.FindById(payload.Id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">if payload.Name == "" </span><span class="cov0" title="0">{
                payload.Name = result.Name
        }</span>

        <span class="cov8" title="1">if payload.Nominal == 0 </span><span class="cov0" title="0">{
                payload.Nominal = result.Nominal
        }</span>
        <span class="cov8" title="1">if payload.Unit == "" </span><span class="cov0" title="0">{
                payload.Unit = result.Unit
        }</span>

        <span class="cov8" title="1">if payload.Unit != "rupiah" &amp;&amp; payload.Unit != "percent" </span><span class="cov8" title="1">{
                return fmt.Errorf("unit must be rupiah or percent")
        }</span>

        <span class="cov8" title="1">err = a.repo.Update(payload)
        if err != nil </span><span class="cov8" title="1">{
                return fmt.Errorf("failed to update app: %v", err)
        }</span>

        <span class="cov8" title="1">return nil</span>
}

func NewAppHandlingCostUseCase(repo repository.AppHandlingCost) AppHandlingCostUsecase <span class="cov8" title="1">{
        return &amp;appHandlingCostUseCase{
                repo: repo,
        }
}</span>
</pre>
		
		<pre class="file" id="file21" style="display: none">package usecase

import (
        "polen/model/dto"
        "polen/repository"
        "polen/utils/security"
)

type AuthUseCase interface {
        Login(payload dto.AuthLoginRequest) (dto.AuthResponse, error)
}

type authUseCase struct {
        repo repository.UserRepository
}

// Login implements AuthUseCase.
func (a *authUseCase) Login(payload dto.AuthLoginRequest) (dto.AuthResponse, error) <span class="cov0" title="0">{
        // Username di db
        user, err := a.repo.FindByUsername(payload.Username)
        if err != nil </span><span class="cov0" title="0">{
                return dto.AuthResponse{}, err
        }</span>
        // Validasi Password
        <span class="cov0" title="0">err = security.VerifyPassword(user.Password, payload.Password)
        if err != nil </span><span class="cov0" title="0">{
                return dto.AuthResponse{}, err
        }</span>

        // Generate Token
        <span class="cov0" title="0">token, err := security.GenerateJwtToken(user)
        if err != nil </span><span class="cov0" title="0">{
                return dto.AuthResponse{}, err
        }</span>
        <span class="cov0" title="0">return dto.AuthResponse{
                Username: user.Username,
                Token:    token,
        }, nil</span>
}

func NewAuthUseCase(repo repository.UserRepository) AuthUseCase <span class="cov0" title="0">{
        return &amp;authUseCase{repo: repo}
}</span>
</pre>
		
		<pre class="file" id="file22" style="display: none">package usecase

import (
        "fmt"
        "polen/model"
        "polen/model/dto"
        "polen/repository"
        "polen/utils/common"
        "time"

        "github.com/gin-gonic/gin"
)

type BiodataUserUseCase interface {
        FindByUserCredential(ctx *gin.Context) (dto.BiodataResponse, error)
        FindByUcId(id string) (dto.BiodataResponse, error)
        FindUserUpdated() ([]dto.BiodataResponse, error)
        UserUpdate(payload dto.BiodataRequest, ctx *gin.Context) (int, error)
        AdminUpdate(payload dto.UpdateBioRequest, ctx *gin.Context) (int, error)
        Paging(payload dto.PageRequest) ([]dto.BiodataResponse, dto.Paging, error)
}

type biodataUserUseCase struct {
        repo   repository.BiodataUser
        userUC UserUseCase
        ctx    *gin.Context
}

// Paging implements BiodataUserUseCase.
func (bio *biodataUserUseCase) Paging(payload dto.PageRequest) ([]dto.BiodataResponse, dto.Paging, error) <span class="cov8" title="1">{
        // limit Size, Offset (page - 1) * size
        if payload.Page &lt; 0 </span><span class="cov8" title="1">{
                payload.Page = 1
        }</span>
        <span class="cov8" title="1">return bio.repo.Pagging(payload)</span>
}

// FindByUcId implements BiodataUserUseCase.
func (bio *biodataUserUseCase) FindByUcId(id string) (dto.BiodataResponse, error) <span class="cov8" title="1">{
        return bio.repo.FindByUcId(id)
}</span>

// AdminUpdate implements BiodataUserUseCase.
func (bio *biodataUserUseCase) AdminUpdate(payload dto.UpdateBioRequest, ctx *gin.Context) (int, error) <span class="cov8" title="1">{
        if payload.Information == "" </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("information detail is required")
        }</span>
        <span class="cov8" title="1">biodata := model.BiodataUser{
                IsAglible:   payload.IsAglible,
                Information: payload.Information,
        }
        result, err := bio.FindByUcId(payload.UserCredentialId)
        if err != nil </span><span class="cov8" title="1">{
                return 500, err
        }</span>
        <span class="cov0" title="0">biodata.Id = result.Id
        if biodata.IsAglible </span><span class="cov0" title="0">{
                biodata.StatusUpdate = true
        }</span>
        <span class="cov0" title="0">err = bio.repo.AdminUpdate(biodata)
        if err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>
        <span class="cov0" title="0">return 200, nil</span>
}

// UserUpdate implements BiodataUserUseCase.
func (bio *biodataUserUseCase) UserUpdate(payload dto.BiodataRequest, ctx *gin.Context) (int, error) <span class="cov0" title="0">{
        if payload.NamaLengkap == "" </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("name is required")
        }</span>
        <span class="cov0" title="0">if payload.Nik == "" </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("nik is required")
        }</span>
        <span class="cov0" title="0">if payload.Nik == "" </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("nik is required")
        }</span>
        <span class="cov0" title="0">if payload.NomorTelepon == "" </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("phone is required")
        }</span>
        <span class="cov0" title="0">if payload.Pekerjaan == "" </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("job is required")
        }</span>
        <span class="cov0" title="0">if payload.TanggalLahir == "" </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("birth date is required")
        }</span>
        <span class="cov0" title="0">if payload.TempatLahir == "" </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("place of birth is required")
        }</span>
        <span class="cov0" title="0">if payload.KodePos == "" </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("postal code is required")
        }</span>
        // find data by user credential
        <span class="cov0" title="0">result, err := bio.FindByUserCredential(ctx)
        if err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>
        // made payload
        <span class="cov0" title="0">layout := "2006-01-02"
        parsedTime, err := time.Parse(layout, payload.TanggalLahir)
        if err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>
        <span class="cov0" title="0">ucId, err := common.GetId(ctx)
        if err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>
        <span class="cov0" title="0">biodata := model.BiodataUser{
                Id:             result.Id,
                UserCredential: model.UserCredential{Id: ucId},
                NamaLengkap:    payload.NamaLengkap,
                Nik:            payload.Nik,
                NomorTelepon:   payload.NomorTelepon,
                Pekerjaan:      payload.Pekerjaan,
                TempatLahir:    payload.TempatLahir,
                TanggalLahir:   parsedTime,
                KodePos:        payload.KodePos,
                StatusUpdate:   true,
                Information:    "waiting for acceptence",
        }
        if result.IsAglible </span><span class="cov0" title="0">{
                biodata.IsAglible = false
        }</span>
        <span class="cov0" title="0">err = bio.repo.UserUpdate(biodata)
        if err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>
        <span class="cov0" title="0">return 200, nil</span>
}

// FindUserUpdated implements BiodataUserUseCase.
func (bio *biodataUserUseCase) FindUserUpdated() ([]dto.BiodataResponse, error) <span class="cov8" title="1">{
        return bio.repo.FindUserUpdated()
}</span>

// FindByUserCredential implements BiodataUserUseCase.
func (bio *biodataUserUseCase) FindByUserCredential(ctx *gin.Context) (dto.BiodataResponse, error) <span class="cov0" title="0">{
        id, err := common.GetId(ctx)
        if err != nil </span><span class="cov0" title="0">{
                return dto.BiodataResponse{}, err
        }</span>
        <span class="cov0" title="0">return bio.repo.FindByUcId(id)</span>
}

func NewBiodataUserUseCase(repo repository.BiodataUser, userUC UserUseCase, ctx *gin.Context) BiodataUserUseCase <span class="cov8" title="1">{
        return &amp;biodataUserUseCase{
                repo:   repo,
                userUC: userUC,
                ctx:    ctx,
        }
}</span>
</pre>
		
		<pre class="file" id="file23" style="display: none">package usecase

import (
        "fmt"
        "polen/model"
        "polen/model/dto"
        "polen/repository"
        "polen/utils/common"
        "time"
)

type DepositeInterestUseCase interface {
        CreateNew(payload dto.DepositeInterestRequest) (int, error)
        Pagging(payload dto.PageRequest) ([]dto.DepositeInterestRequest, dto.Paging, error)
        FindById(id string) (dto.DepositeInterestRequest, error)
        Update(payload dto.DepositeInterestRequest) error
        DeleteById(id string) error
}

type depositeInterestUseCase struct {
        repo repository.DepositeInterest
}

// Pagging implements DepositeInterestUseCase.
func (d *depositeInterestUseCase) Pagging(payload dto.PageRequest) ([]dto.DepositeInterestRequest, dto.Paging, error) <span class="cov8" title="1">{
        // limit Size, Offset (page - 1) * size
        if payload.Page &lt; 0 </span><span class="cov8" title="1">{
                payload.Page = 1
        }</span>
        <span class="cov8" title="1">return d.repo.Pagging(payload)</span>
}

// DeleteById implements DepositeInterestUseCase.
func (d *depositeInterestUseCase) DeleteById(id string) error <span class="cov8" title="1">{
        deposite, err := d.repo.FindById(id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">err = d.repo.DeleteById(deposite.Id)
        if err != nil </span><span class="cov8" title="1">{
                return fmt.Errorf("failed to delete deposite: %v", err)
        }</span>

        <span class="cov8" title="1">return nil</span>
}

// FindById implements DepositeInterestUseCase.
func (d *depositeInterestUseCase) FindById(id string) (dto.DepositeInterestRequest, error) <span class="cov8" title="1">{
        return d.repo.FindById(id)
}</span>

// Update implements DepositeInterestUseCase.
func (d *depositeInterestUseCase) Update(payload dto.DepositeInterestRequest) error <span class="cov8" title="1">{
        if payload.Id == "" </span><span class="cov8" title="1">{
                return fmt.Errorf("id is required")
        }</span>

        <span class="cov8" title="1">result, err := d.FindById(payload.Id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">if payload.InterestRate == 0 </span><span class="cov8" title="1">{
                payload.InterestRate = result.InterestRate
        }</span>
        <span class="cov8" title="1">if payload.TaxRate == 0 </span><span class="cov8" title="1">{
                payload.TaxRate = result.TaxRate
        }</span>
        <span class="cov8" title="1">if payload.DurationMounth == 0 </span><span class="cov8" title="1">{
                payload.DurationMounth = result.DurationMounth
        }</span>

        <span class="cov8" title="1">err = d.repo.Update(payload)
        if err != nil </span><span class="cov8" title="1">{
                return fmt.Errorf("failed to update deposite: %v", err)
        }</span>

        <span class="cov8" title="1">return nil</span>
}

// CreateNew implements DepositeInteresetUseCase.
func (d *depositeInterestUseCase) CreateNew(payload dto.DepositeInterestRequest) (int, error) <span class="cov8" title="1">{
        if payload.Id == "" </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("id is required")
        }</span>
        <span class="cov8" title="1">if payload.InterestRate == 0 </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("interest rate is required")
        }</span>
        <span class="cov8" title="1">if payload.TaxRate == 0 </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("tax is required")
        }</span>
        <span class="cov8" title="1">if payload.DurationMounth == 0 </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("duration month is required")
        }</span>
        <span class="cov0" title="0">model := model.DepositeInterest{
                Id:             common.GenerateID(),
                CreateDate:     time.Now(),
                InterestRate:   payload.InterestRate,
                TaxRate:        payload.TaxRate,
                DurationMounth: payload.DurationMounth,
        }

        if err := d.repo.Save(model); err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>
        <span class="cov0" title="0">return 201, nil</span>
}

func NewDepositeInterestUseCase(repo repository.DepositeInterest) DepositeInterestUseCase <span class="cov8" title="1">{
        return &amp;depositeInterestUseCase{
                repo: repo,
        }
}</span>
</pre>
		
		<pre class="file" id="file24" style="display: none">package usecase

import (
        "fmt"
        "polen/model/dto"
        "polen/repository"
        "polen/utils/common"
        "time"
)

type DepositeUseCase interface {
        CreateDeposite(payload dto.DepositeDto) (int, error)
        FindByUcId(id string) (int, dto.DepositeByUserResponse, error)
        FindById(id string) (int, dto.DepositeByIdResponse, error)
        Pagging(payload dto.PageRequest) ([]dto.Deposite, dto.Paging, error)
        Update() error
}

type depositeUseCase struct {
        repo    repository.DepositeRepository
        intRate DepositeInterestUseCase
        saldo   SaldoUsecase
}

// Update implements DepositeUseCase.
func (d *depositeUseCase) Update() error <span class="cov8" title="1">{
        return d.repo.Update()
}</span>

// Pagging implements DepositeUseCase.
func (d *depositeUseCase) Pagging(payload dto.PageRequest) ([]dto.Deposite, dto.Paging, error) <span class="cov8" title="1">{
        // limit Size, Offset (page - 1) * size
        if payload.Page &lt; 0 </span><span class="cov8" title="1">{
                payload.Page = 1
        }</span>
        <span class="cov8" title="1">return d.repo.Pagging(payload)</span>
}

// FindById implements DepositeUseCase.
func (d *depositeUseCase) FindById(id string) (int, dto.DepositeByIdResponse, error) <span class="cov8" title="1">{
        if id == "" </span><span class="cov8" title="1">{
                return 400, dto.DepositeByIdResponse{}, fmt.Errorf("id user is required")
        }</span>
        <span class="cov8" title="1">resut, err := d.repo.FindById(id)
        if err != nil </span><span class="cov8" title="1">{
                return 500, dto.DepositeByIdResponse{}, err
        }</span>
        <span class="cov8" title="1">return 200, resut, nil</span>
}

// FindByUcId implements DepositeUseCase.
func (d *depositeUseCase) FindByUcId(id string) (int, dto.DepositeByUserResponse, error) <span class="cov8" title="1">{
        if id == "" </span><span class="cov8" title="1">{
                return 400, dto.DepositeByUserResponse{}, fmt.Errorf("id user is required")
        }</span>
        <span class="cov8" title="1">resut, err := d.repo.FindByUcId(id)
        if err != nil </span><span class="cov8" title="1">{
                return 500, dto.DepositeByUserResponse{}, err
        }</span>
        <span class="cov8" title="1">return 200, resut, nil</span>
}

// CreateDeposite implements DepositeUseCase.
func (d *depositeUseCase) CreateDeposite(payload dto.DepositeDto) (int, error) <span class="cov8" title="1">{
        // check input
        if payload.InterestRate.Id == "" </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("interest rate is required")
        }</span>
        <span class="cov8" title="1">if payload.DepositeAmount &lt;= 0 </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("deposite amount must greather than zero")
        }</span>
        // check apakah saldo cukup
        <span class="cov0" title="0">saldo, err := d.saldo.FindByIdUser(payload.UserCredential.Id)
        if err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>
        <span class="cov0" title="0">if payload.DepositeAmount &gt; saldo.Total </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("saldo balance isnt enought")
        }</span>

        // generate id
        <span class="cov0" title="0">uuid := common.GenerateID()
        payload.Id = uuid

        // get data interest rate
        payload.InterestRate, err = d.intRate.FindById(payload.InterestRate.Id)
        if err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>

        // building payload
        <span class="cov0" title="0">payload.MaturityDate = time.Now().Add(time.Duration(payload.InterestRate.DurationMounth*30) * 24 * time.Hour)
        payload.Status = true
        payload.GrossProfit = (int(float64(payload.DepositeAmount)*payload.InterestRate.InterestRate) * payload.InterestRate.DurationMounth) / 365 // (setoran pokok*interest rate*durationDay)/365
        payload.Tax = int(float64(payload.GrossProfit) * payload.InterestRate.TaxRate)                                                             // TaxRate*grossProfit
        payload.NetProfit = payload.GrossProfit - payload.Tax                                                                                      // grossProfit-tax
        payload.TotalReturn = payload.DepositeAmount + payload.NetProfit                                                                           // setoran+netProfit

        err = d.repo.CreateDeposite(payload)
        if err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>
        <span class="cov0" title="0">return 200, nil</span>
}

func NewDepositeUseCase(repo repository.DepositeRepository, intRate DepositeInterestUseCase, saldo SaldoUsecase) DepositeUseCase <span class="cov8" title="1">{
        return &amp;depositeUseCase{
                repo:    repo,
                intRate: intRate,
                saldo:   saldo,
        }
}</span>
</pre>
		
		<pre class="file" id="file25" style="display: none">package usecase

import (
        "fmt"
        "polen/model"
        "polen/model/dto"
        "polen/repository"
)

type LatePaymentFeeUsecase interface {
        CreateNew(payload model.LatePaymentFee) (int, error)
        Pagging(payload dto.PageRequest) ([]model.LatePaymentFee, dto.Paging, error)
        FindById(id string) (model.LatePaymentFee, error)
        Update(payload model.LatePaymentFee) error
        DeleteById(id string) error
}

type latePaymentFeeUseCase struct {
        repo repository.LatePaymentFee
}

// CreateNew implements LatePaymentFeeUsecase.
func (a *latePaymentFeeUseCase) CreateNew(payload model.LatePaymentFee) (int, error) <span class="cov8" title="1">{
        if payload.Id == "" </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("id is required")
        }</span>
        <span class="cov8" title="1">if payload.Name == "" </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("name is required")
        }</span>
        <span class="cov8" title="1">if payload.Nominal == 0 </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("nominal is required")
        }</span>

        <span class="cov8" title="1">if payload.Unit == "" </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("unit is required")
        }</span>

        <span class="cov8" title="1">if payload.Unit != "rupiah" &amp;&amp; payload.Unit != "percent" </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("unit must be rupiah or percent")
        }</span>

        <span class="cov8" title="1">if err := a.repo.CreateNew(payload); err != nil </span><span class="cov8" title="1">{
                return 500, err
        }</span>
        <span class="cov8" title="1">return 201, nil</span>
}

// DeleteById implements LatePaymentFeeUsecase.
func (a *latePaymentFeeUseCase) DeleteById(id string) error <span class="cov8" title="1">{
        app, err := a.repo.FindById(id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">err = a.repo.DeleteById(app.Id)
        if err != nil </span><span class="cov8" title="1">{
                return fmt.Errorf("failed to delete app handling cost: %v", err)
        }</span>

        <span class="cov8" title="1">return nil</span>
}

// FindById implements LatePaymentFeeUsecase.
func (a *latePaymentFeeUseCase) FindById(id string) (model.LatePaymentFee, error) <span class="cov8" title="1">{
        return a.repo.FindById(id)
}</span>

// Pagging implements LatePaymentFeeUsecase.
func (a *latePaymentFeeUseCase) Pagging(payload dto.PageRequest) ([]model.LatePaymentFee, dto.Paging, error) <span class="cov8" title="1">{
        return a.repo.Pagging(payload)
}</span>

// Update implements LatePaymentFeeUsecase.
func (a *latePaymentFeeUseCase) Update(payload model.LatePaymentFee) error <span class="cov8" title="1">{
        if payload.Id == "" </span><span class="cov8" title="1">{
                return fmt.Errorf("id is required")
        }</span>

        <span class="cov8" title="1">result, err := a.FindById(payload.Id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">if payload.Name == "" </span><span class="cov0" title="0">{
                payload.Name = result.Name
        }</span>

        <span class="cov8" title="1">if payload.Nominal == 0 </span><span class="cov0" title="0">{
                payload.Nominal = result.Nominal
        }</span>
        <span class="cov8" title="1">if payload.Unit == "" </span><span class="cov0" title="0">{
                payload.Unit = result.Unit
        }</span>

        <span class="cov8" title="1">if payload.Unit != "rupiah" &amp;&amp; payload.Unit != "percent" </span><span class="cov8" title="1">{
                return fmt.Errorf("unit must be rupiah or percent")
        }</span>

        <span class="cov8" title="1">err = a.repo.Update(payload)
        if err != nil </span><span class="cov8" title="1">{
                return fmt.Errorf("failed to update app: %v", err)
        }</span>

        <span class="cov8" title="1">return nil</span>
}

func NewLatePaymentFeeUseCase(repo repository.LatePaymentFee) LatePaymentFeeUsecase <span class="cov8" title="1">{
        return &amp;latePaymentFeeUseCase{
                repo: repo,
        }
}</span>
</pre>
		
		<pre class="file" id="file26" style="display: none">package usecase

import (
        "fmt"
        "polen/model"
        "polen/model/dto"
        "polen/repository"
)

type LoanInterestUseCase interface {
        CreateNew(payload model.LoanInterest) (int, error)
        Pagging(payload dto.PageRequest) ([]model.LoanInterest, dto.Paging, error)
        FindById(id string) (model.LoanInterest, error)
        Update(payload model.LoanInterest) error
        DeleteById(id string) error
}

type loanInterestUseCase struct {
        repo repository.LoanInterest
}

// CreateNew implements LoanInterestUseCase.
func (l *loanInterestUseCase) CreateNew(payload model.LoanInterest) (int, error) <span class="cov8" title="1">{
        if payload.Id == "" </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("id is required")
        }</span>
        <span class="cov8" title="1">if payload.DurationMonths == 0 </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("duration month is required")
        }</span>
        <span class="cov8" title="1">if payload.LoanInterestRate == 0 </span><span class="cov8" title="1">{
                return 400, fmt.Errorf("loan interest rate is required")
        }</span>
        <span class="cov8" title="1">if err := l.repo.CreateNew(payload); err != nil </span><span class="cov8" title="1">{
                return 500, err
        }</span>
        <span class="cov8" title="1">return 201, nil</span>
}

// DeleteById implements LoanInterestUseCase.
func (l *loanInterestUseCase) DeleteById(id string) error <span class="cov8" title="1">{
        loan, err := l.repo.FindById(id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">err = l.repo.DeleteById(loan.Id)
        if err != nil </span><span class="cov8" title="1">{
                return fmt.Errorf("failed to delete loan: %v", err)
        }</span>

        <span class="cov8" title="1">return nil</span>
}

// FindById implements LoanInterestUseCase.
func (l *loanInterestUseCase) FindById(id string) (model.LoanInterest, error) <span class="cov8" title="1">{
        return l.repo.FindById(id)
}</span>

// Pagging implements LoanInterestUseCase.
func (l *loanInterestUseCase) Pagging(payload dto.PageRequest) ([]model.LoanInterest, dto.Paging, error) <span class="cov8" title="1">{
        return l.repo.Pagging(payload)
}</span>

// Update implements LoanInterestUseCase.
func (l *loanInterestUseCase) Update(payload model.LoanInterest) error <span class="cov8" title="1">{
        if payload.Id == "" </span><span class="cov8" title="1">{
                return fmt.Errorf("id is required")
        }</span>

        <span class="cov8" title="1">result, err := l.FindById(payload.Id)
        if err != nil </span><span class="cov8" title="1">{
                return err
        }</span>

        <span class="cov8" title="1">if payload.DurationMonths == 0 </span><span class="cov0" title="0">{
                payload.DurationMonths = result.DurationMonths
        }</span>
        <span class="cov8" title="1">if payload.LoanInterestRate == 0 </span><span class="cov0" title="0">{
                payload.LoanInterestRate = result.LoanInterestRate
        }</span>

        <span class="cov8" title="1">err = l.repo.Update(payload)
        if err != nil </span><span class="cov8" title="1">{
                return fmt.Errorf("failed to update loan interest: %v", err)
        }</span>

        <span class="cov8" title="1">return nil</span>
}

func NewLoanInterestUseCase(repo repository.LoanInterest) LoanInterestUseCase <span class="cov8" title="1">{
        return &amp;loanInterestUseCase{
                repo: repo,
        }
}</span>
</pre>
		
		<pre class="file" id="file27" style="display: none">package usecase

import (
        "fmt"
        "polen/model"
        "polen/model/dto"
        "polen/repository"
        "polen/utils/common"
        "time"
)

type LoanUseCase interface {
        Create(payload dto.LoanRequest) (int, error)
        FindById(id string) (dto.InstallenmentLoanByIdResponse, error)
        UploadFile(iduc string, payload dto.LoanInstallenmentResponse) (int, error)
        FindUploadedFile() ([]dto.LoanInstallenmentResponse, error)
        Accepted(payload dto.InstallenmentLoanByIdResponse) error
        UpdateLateFee() error
        FindByLoanId(id string) (dto.Loan, error)
}

type loanUseCase struct {
        repo    repository.LoanRepository
        loanIr  LoanInterestUseCase
        loanHc  AppHandlingCostUsecase
        loanLPF LatePaymentFeeUsecase
}

// FindByLoanId implements LoanUseCase.
func (l *loanUseCase) FindByLoanId(id string) (dto.Loan, error) <span class="cov8" title="1">{
        return l.repo.FindByLoanId(id)
}</span>

// Accepted implements LoanUseCase.
func (l *loanUseCase) Accepted(payload dto.InstallenmentLoanByIdResponse) error <span class="cov8" title="1">{
        return l.repo.Accepted(payload)
}</span>

// UpdateLateFee implements LoanUseCase.
func (l *loanUseCase) UpdateLateFee() error <span class="cov8" title="1">{
        return l.repo.UpdateLateFee()
}</span>

// FindUploadedFile implements LoanUseCase.
func (l *loanUseCase) FindUploadedFile() ([]dto.LoanInstallenmentResponse, error) <span class="cov8" title="1">{
        return l.repo.FindUploadedFile()
}</span>

// FindById implements LoanUseCase.
func (l *loanUseCase) FindById(id string) (dto.InstallenmentLoanByIdResponse, error) <span class="cov8" title="1">{
        return l.repo.FindById(id)
}</span>

// Create implements LoanUseCase.
func (loan *loanUseCase) Create(payload dto.LoanRequest) (int, error) <span class="cov0" title="0">{
        if payload.LoanInterestRateId == "" </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("loan interest rate is required")
        }</span>
        <span class="cov0" title="0">if payload.LoanHandlingCostId == "" </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("loan handling cost is required")
        }</span>
        <span class="cov0" title="0">if payload.LoanLatePaymentFessId == "" </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("loan late payment fees cost is required")
        }</span>
        <span class="cov0" title="0">if payload.LoanAmount &lt;= 0 </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("loan amount cost is must greather than zero")
        }</span>
        <span class="cov0" title="0">loanIr, err := loan.loanIr.FindById(payload.LoanInterestRateId)
        if err != nil </span><span class="cov0" title="0">{
                return 404, fmt.Errorf("loan duration you choose arent available,")
        }</span>
        <span class="cov0" title="0">loanHc, err := loan.loanHc.FindById(payload.LoanHandlingCostId)
        if err != nil </span><span class="cov0" title="0">{
                return 404, fmt.Errorf("handling cost you choose arent available,")
        }</span>
        <span class="cov0" title="0">loanLpf, err := loan.loanLPF.FindById(payload.LoanLatePaymentFessId)
        if err != nil </span><span class="cov0" title="0">{
                return 404, fmt.Errorf("loan ate payment fees you choose arent available,")
        }</span>
        // building payload
        <span class="cov0" title="0">var loanpayload model.Loan
        loanpayload.Id = common.GenerateID()
        loanpayload.UserCredentialId = payload.UserCredentialId
        loanpayload.LoanDateCreate = time.Now()
        loanpayload.LoanDuration = loanIr.DurationMonths
        loanpayload.LoanAmount = payload.LoanAmount
        loanpayload.LoanInterestRate = loanIr.LoanInterestRate
        loanpayload.AppHandlingCostUnit = loanHc.Unit
        // app handling cost
        if loanpayload.AppHandlingCostUnit == "rupiah" </span><span class="cov0" title="0">{
                loanpayload.AppHandlingCostNominal = loanHc.Nominal
        }</span> else<span class="cov0" title="0"> if loanpayload.AppHandlingCostUnit == "percent" </span><span class="cov0" title="0">{
                loanpayload.AppHandlingCostNominal = float64(payload.LoanAmount) * loanHc.Nominal
        }</span>
        // loan rate
        <span class="cov0" title="0">loanpayload.LoanInterestNominal = int(float64(payload.LoanAmount) * loanIr.LoanInterestRate)
        loanpayload.TotalAmountOfDepth = int(float64(loanpayload.LoanAmount) + float64(loanpayload.LoanInterestNominal) + loanpayload.AppHandlingCostNominal)
        loanpayload.Status = "active loan"
        loanpayload.IsPayed = false

        var instalenmentpayload []model.InstallenmentLoan
        type paymentInstallment struct {
                paymentDeadLine time.Time
                total           int
        }
        var pis []paymentInstallment

        for i := 1; i &lt;= loanIr.DurationMonths; i++ </span><span class="cov0" title="0">{
                pi := paymentInstallment{
                        paymentDeadLine: time.Now().AddDate(0, i, 0),
                        total:           loanpayload.TotalAmountOfDepth / loanIr.DurationMonths,
                }
                pis = append(pis, pi)
        }</span>

        <span class="cov0" title="0">for _, v := range pis </span><span class="cov0" title="0">{
                // build payload installentment
                var instalenment model.InstallenmentLoan
                instalenment.Id = common.GenerateID()
                instalenment.LoanId = loanpayload.Id
                instalenment.IsPayed = false
                instalenment.PaymentInstallment = v.total
                instalenment.PaymentDeadLine = v.paymentDeadLine
                instalenment.TotalAmountOfDepth = v.total
                instalenment.LatePaymentFeesUnit = loanLpf.Unit
                instalenment.LatePaymentFeesNominal = loanLpf.Nominal
                instalenment.LatePaymentFeesTotal = 0
                instalenment.LatePaymentDays = 0
                instalenment.Status = "waiting for payment"
                instalenment.TransferConfirmRecipe = false
                instalenment.File = ""
                instalenmentpayload = append(instalenmentpayload, instalenment)
        }</span>

        // save
        <span class="cov0" title="0">err = loan.repo.Create(loanpayload, instalenmentpayload)
        if err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>

        <span class="cov0" title="0">return 200, nil</span>
}

func (t *loanUseCase) UploadFile(iduc string, payload dto.LoanInstallenmentResponse) (int, error) <span class="cov0" title="0">{
        // check is data available
        dataTopUp, err := t.FindById(payload.Id)
        if err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>
        <span class="cov0" title="0">if dataTopUp.UserDeatail.UserCredential.Id != iduc </span><span class="cov0" title="0">{
                return 403, fmt.Errorf("you arent allowed")
        }</span>
        <span class="cov0" title="0">dataTopUp.LoanInst.File = payload.File

        err = t.repo.Upload(payload)
        if err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>
        <span class="cov0" title="0">return 200, err</span>
}

func NewLoanUseCase(repo repository.LoanRepository, loanir LoanInterestUseCase, loanhc AppHandlingCostUsecase, loanLPF LatePaymentFeeUsecase) LoanUseCase <span class="cov8" title="1">{
        return &amp;loanUseCase{
                repo:    repo,
                loanIr:  loanir,
                loanHc:  loanhc,
                loanLPF: loanLPF,
        }
}</span>
</pre>
		
		<pre class="file" id="file28" style="display: none">package usecase

import (
        "polen/model/dto"
        "polen/repository"
)

type SaldoUsecase interface {
        FindByIdUser(id string) (dto.Saldo, error)
        Pagging(payload dto.PageRequest) ([]dto.Saldo, dto.Paging, error)
}

type saldoUsecase struct {
        repo repository.SaldoRepository
}

// FindByIdUser implements SaldoUsecase.
func (s *saldoUsecase) FindByIdUser(id string) (dto.Saldo, error) <span class="cov8" title="1">{
        return s.repo.FindByIdUser(id)
}</span>

// Pagging implements SaldoUsecase.
func (s *saldoUsecase) Pagging(payload dto.PageRequest) ([]dto.Saldo, dto.Paging, error) <span class="cov8" title="1">{
        return s.repo.Pagging(payload)
}</span>

func NewSaldoUsecase(repo repository.SaldoRepository) SaldoUsecase <span class="cov8" title="1">{
        return &amp;saldoUsecase{
                repo: repo,
        }
}</span>
</pre>
		
		<pre class="file" id="file29" style="display: none">package usecase

import (
        "fmt"
        "os"
        "polen/model"
        "polen/model/dto"
        "polen/repository"
        "polen/utils/common"
        "time"
)

type TopUpUseCase interface {
        CreateNew(payload dto.TopUpUser) (dto.TopUpUser, error)
        FindByIdUser(id string) (dto.TopUpByUser, error)
        FindById(id string) (dto.TopUpById, error)
        UploadFile(payload dto.TopUpUser) (int, error)
        FindUploadedFile() ([]dto.TopUp, error)
        ConfimUploadFile(payload dto.TopUpUser) (int, error)
        Pagging(payload dto.PageRequest) ([]dto.TopUp, dto.Paging, error)
}

type topUpUseCase struct {
        repo   repository.TopUp
        userUC UserUseCase
}

// Pagging implements TopUpUseCase.
func (t *topUpUseCase) Pagging(payload dto.PageRequest) ([]dto.TopUp, dto.Paging, error) <span class="cov8" title="1">{
        // limit Size, Offset (page - 1) * size
        if payload.Page &lt; 0 </span><span class="cov8" title="1">{
                payload.Page = 1
        }</span>
        <span class="cov8" title="1">return t.repo.Pagging(payload)</span>
}

// FindUploadedFile implements TopUpUseCase.
func (t *topUpUseCase) FindUploadedFile() ([]dto.TopUp, error) <span class="cov8" title="1">{
        return t.repo.FindUploadedFile()
}</span>

// ConfimUploadFile implements TopUpUseCase.
func (t *topUpUseCase) ConfimUploadFile(payload dto.TopUpUser) (int, error) <span class="cov0" title="0">{
        if payload.Id == "" </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("id is required")
        }</span>
        <span class="cov0" title="0">data, err := t.FindById(payload.Id)
        if err != nil </span><span class="cov0" title="0">{
                if data.UserCredential.Id == "" </span><span class="cov0" title="0">{
                        return 404, fmt.Errorf("data to update isnt found")
                }</span>
                <span class="cov0" title="0">return 500, err</span>
        }
        <span class="cov0" title="0">if payload.Status == "" </span><span class="cov0" title="0">{
                return 400, fmt.Errorf("information is required")
        }</span>
        <span class="cov0" title="0">if !payload.Accepted /*false*/ </span><span class="cov0" title="0">{
                fmt.Println("benar")
                err = t.repo.NotConfimUpload(model.TopUp{
                        Id:                    payload.Id,
                        Accepted:              payload.Accepted,
                        AcceptedTime:          data.TopUp.AcceptedTime,
                        MaturityTime:          time.Now().Add(2 * 24 * time.Hour),
                        Status:                payload.Status,
                        TransferConfirmRecipe: false,
                        File:                  "",
                })
                if err != nil </span><span class="cov0" title="0">{
                        return 500, err
                }</span>
                // delete file
                <span class="cov0" title="0">_ = os.Remove(payload.File)
                return 200, nil</span>
        } else<span class="cov0" title="0"> {
                fmt.Println("salah")
                err = t.repo.ConfimUpload(model.TopUp{
                        Id:                    payload.Id,
                        UserCredential:        model.UserCredential{Id: data.UserCredential.Id},
                        TopUpAmount:           data.TopUp.TopUpAmount,
                        Accepted:              payload.Accepted,
                        AcceptedTime:          time.Now(),
                        MaturityTime:          data.TopUp.MaturityTime,
                        Status:                payload.Status,
                        TransferConfirmRecipe: data.TopUp.TransferConfirmRecipe,
                        File:                  data.TopUp.File,
                })
                if err != nil </span><span class="cov0" title="0">{
                        return 500, err
                }</span>
                <span class="cov0" title="0">return 200, nil</span>
        }
}

// FindById implements TopUpUseCase.
func (t *topUpUseCase) FindById(id string) (dto.TopUpById, error) <span class="cov8" title="1">{
        return t.repo.FindById(id)
}</span>

// FindByIdUser implements TopUpUseCase.
func (t *topUpUseCase) FindByIdUser(id string) (dto.TopUpByUser, error) <span class="cov8" title="1">{
        return t.repo.FindByIdUser(id)
}</span>

func (t *topUpUseCase) UploadFile(payload dto.TopUpUser) (int, error) <span class="cov0" title="0">{
        data := model.TopUp{
                Id:                    payload.Id,
                File:                  payload.File,
                Status:                "waiting for acceptance",
                TransferConfirmRecipe: true,
        }
        // check is data available
        dataTopUp, err := t.FindById(data.Id)
        if err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>

        <span class="cov0" title="0">if dataTopUp.UserCredential.Id == "" </span><span class="cov0" title="0">{
                return 404, fmt.Errorf("data top up not found")
        }</span>

        <span class="cov0" title="0">if dataTopUp.UserCredential.Id != payload.UserCredential.Id </span><span class="cov0" title="0">{
                return 403, fmt.Errorf("you are not allowed to do this")
        }</span>

        <span class="cov0" title="0">err = t.repo.Upload(data)
        if err != nil </span><span class="cov0" title="0">{
                return 500, err
        }</span>
        <span class="cov0" title="0">return 200, err</span>
}

// CreateNew implements TopUpUseCase.
func (t *topUpUseCase) CreateNew(payload dto.TopUpUser) (dto.TopUpUser, error) <span class="cov0" title="0">{
        // cek apakah jumlah top up lebih dari 0
        if payload.TopUpAmount &lt;= 0 </span><span class="cov0" title="0">{
                return dto.TopUpUser{}, fmt.Errorf("top up must be greater than zero")
        }</span>

        <span class="cov0" title="0">uc, err := t.userUC.FindById(payload.UserCredential.Id)
        if err != nil </span><span class="cov0" title="0">{
                return dto.TopUpUser{}, err
        }</span>

        <span class="cov0" title="0">modelPayload := model.TopUp{
                Id:                    common.GenerateID(),
                UserCredential:        uc,
                TopUpAmount:           payload.TopUpAmount,
                MaturityTime:          time.Now().Add(2 * 24 * time.Hour), // Menambahkan 2 hari ke waktu sekarang
                Accepted:              false,
                Status:                "waiting upoload of transfer recipe",
                TransferConfirmRecipe: false,
                File:                  "",
        }

        err = t.repo.Save(modelPayload)
        if err != nil </span><span class="cov0" title="0">{
                return dto.TopUpUser{}, fmt.Errorf("failed to save new topup: %v", err)
        }</span>

        <span class="cov0" title="0">payload.UserCredential.Email = modelPayload.UserCredential.Email
        payload.UserCredential.Password = "*******"
        payload.UserCredential.Username = modelPayload.UserCredential.Username
        payload.UserCredential.VaNumber = modelPayload.UserCredential.VANumber
        payload.UserCredential.IsActive = modelPayload.UserCredential.IsActive
        payload.UserCredential.Role = modelPayload.UserCredential.Role
        payload.MaturityTime = modelPayload.MaturityTime
        payload.AcceptedTime = modelPayload.AcceptedTime
        payload.Accepted = modelPayload.Accepted
        payload.Status = modelPayload.Status
        payload.TransferConfirmRecipe = modelPayload.TransferConfirmRecipe

        return payload, nil</span>
}

func NewTopUpUseCase(repo repository.TopUp, userUC UserUseCase) TopUpUseCase <span class="cov8" title="1">{
        return &amp;topUpUseCase{
                repo:   repo,
                userUC: userUC,
        }
}</span>
</pre>
		
		<pre class="file" id="file30" style="display: none">package usecase

import (
        "fmt"
        "polen/model"
        "polen/model/dto"
        "polen/repository"
        "polen/utils/common"
        "polen/utils/security"
        "regexp"

        "github.com/gin-gonic/gin"
)

type UserUseCase interface {
        FindByUsername(username string, ctx *gin.Context) (model.UserCredential, error)
        Register(payload dto.AuthRequest) error
        Paging(payload dto.PageRequest, ctx *gin.Context) ([]model.UserCredential, dto.Paging, error)
        FindById(id string) (model.UserCredential, error)
}

type userUseCase struct {
        repo repository.UserRepository
        ctx  *gin.Context
}

// Paging implements UserUseCase.
func (u *userUseCase) Paging(payload dto.PageRequest, ctx *gin.Context) ([]model.UserCredential, dto.Paging, error) <span class="cov0" title="0">{
        // limit Size, Offset (page - 1) * size
        if payload.Page &lt; 0 </span><span class="cov0" title="0">{
                payload.Page = 1
        }</span>
        <span class="cov0" title="0">role, err := common.GetRole(ctx)
        if err != nil </span><span class="cov0" title="0">{
                return nil, dto.Paging{}, err
        }</span>
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                return nil, dto.Paging{}, fmt.Errorf("you are not allowed")
        }</span>
        <span class="cov0" title="0">return u.repo.Pagging(payload)</span>
}

// FindById implements UserUseCase.
func (u *userUseCase) FindById(id string) (model.UserCredential, error) <span class="cov8" title="1">{
        return u.repo.FindById(id)
}</span>

// FindByUsername implements UserUseCase.
func (u *userUseCase) FindByUsername(username string, ctx *gin.Context) (model.UserCredential, error) <span class="cov0" title="0">{
        role, err := common.GetRole(ctx)
        if err != nil </span><span class="cov0" title="0">{
                return model.UserCredential{}, err
        }</span>
        <span class="cov0" title="0">name, err := common.GetName(ctx)
        if err != nil </span><span class="cov0" title="0">{
                return model.UserCredential{}, err
        }</span>
        <span class="cov0" title="0">if role != "admin" </span><span class="cov0" title="0">{
                if name != username </span><span class="cov0" title="0">{
                        return model.UserCredential{}, fmt.Errorf("you are not allowed")
                }</span>
        }
        <span class="cov0" title="0">return u.repo.FindByUsername(username)</span>
}

// Register implements UserUseCase.
func (u *userUseCase) Register(payload dto.AuthRequest) error <span class="cov8" title="1">{
        if payload.Username == "" </span><span class="cov8" title="1">{
                return fmt.Errorf("username required")
        }</span>
        <span class="cov8" title="1">if payload.Password == "" </span><span class="cov8" title="1">{
                return fmt.Errorf("password required")
        }</span>
        <span class="cov8" title="1">if payload.Email == "" </span><span class="cov8" title="1">{
                return fmt.Errorf("email required")
        }</span>
        <span class="cov8" title="1">if payload.Role == "" </span><span class="cov8" title="1">{
                return fmt.Errorf("role is required")
        }</span>
        <span class="cov8" title="1">if payload.Role != "peminjam" &amp;&amp; payload.Role != "pemodal" </span><span class="cov8" title="1">{
                return fmt.Errorf("role you has choose isnt available")
        }</span>
        // Pola regex untuk memeriksa format email
        <span class="cov8" title="1">emailPattern := `^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$`

        // Mencocokkan alamat email dengan pola regex
        isValid := isValidEmail(emailPattern, payload.Email)
        if !isValid </span><span class="cov8" title="1">{
                return fmt.Errorf("is not valid email")
        }</span>

        <span class="cov0" title="0">hashPassword, err := security.HashPassword(payload.Password)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov0" title="0">userCredential := model.UserCredential{
                Id:       common.GenerateID(),
                Username: payload.Username,
                Email:    payload.Email,
                Password: hashPassword,
                VANumber: common.GenerateID(),
                Role:     payload.Role,
        }

        biodataId := common.GenerateID()

        if userCredential.Role == "pemodal" </span><span class="cov0" title="0">{
                saldoId := common.GenerateID()
                err = u.repo.Saldo(userCredential, saldoId, biodataId)
        }</span> else<span class="cov0" title="0"> {
                err = u.repo.Save(userCredential, biodataId)
        }</span>
        <span class="cov0" title="0">if err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("failed save user: %v", err.Error())
        }</span>
        <span class="cov0" title="0">return nil</span>
}

func isValidEmail(pattern, email string) bool <span class="cov8" title="1">{
        match, _ := regexp.MatchString(pattern, email)
        return match
}</span>

func NewUserUseCase(repo repository.UserRepository, ctx *gin.Context) UserUseCase <span class="cov8" title="1">{
        return &amp;userUseCase{
                repo: repo,
                ctx:  ctx,
        }
}</span>
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
